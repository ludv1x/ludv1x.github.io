<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Queries &mdash; ClickHouse  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="ClickHouse  documentation" href="../index.html" />
    <link rel="up" title="Query language" href="index.html" />
    <link rel="next" title="Syntax" href="syntax.html" />
    <link rel="prev" title="clickhouse-local" href="clickhouse_local.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="queries">
<h1>Queries<a class="headerlink" href="#queries" title="Permalink to this headline">¶</a></h1>
<div class="section" id="create-database">
<h2>CREATE DATABASE<a class="headerlink" href="#create-database" title="Permalink to this headline">¶</a></h2>
<p>Creates the &#8216;db_name&#8217; database.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>CREATE DATABASE [IF NOT EXISTS] db_name
</pre></div>
</div>
<p>A database is just a directory for tables.
If &#8220;IF NOT EXISTS&#8221; is included, the query won&#8217;t return an error if the database already exists.</p>
</div>
<div class="section" id="create-table">
<h2>CREATE TABLE<a class="headerlink" href="#create-table" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> query can have several forms.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="p">[</span><span class="k">TEMPORARY</span><span class="p">]</span> <span class="k">TABLE</span> <span class="p">[</span><span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span><span class="p">]</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="n">name</span> <span class="p">[</span><span class="k">ON</span> <span class="k">CLUSTER</span> <span class="k">cluster</span><span class="p">]</span>
<span class="p">(</span>
    <span class="n">name1</span> <span class="p">[</span><span class="n">type1</span><span class="p">]</span> <span class="p">[</span><span class="k">DEFAULT</span><span class="o">|</span><span class="n">MATERIALIZED</span><span class="o">|</span><span class="k">ALIAS</span> <span class="n">expr1</span><span class="p">],</span>
    <span class="n">name2</span> <span class="p">[</span><span class="n">type2</span><span class="p">]</span> <span class="p">[</span><span class="k">DEFAULT</span><span class="o">|</span><span class="n">MATERIALIZED</span><span class="o">|</span><span class="k">ALIAS</span> <span class="n">expr2</span><span class="p">],</span>
    <span class="p">...</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">engine</span>
</pre></div>
</div>
<p>Creates a table named &#8216;name&#8217; in the &#8216;db&#8217; database or the current database if &#8216;db&#8217; is not set, with the structure specified in brackets and the &#8216;engine&#8217; engine. The structure of the table is a list of column descriptions. If indexes are supported by the engine, they are indicated as parameters for the table engine.</p>
<p>A column description is <code class="docutils literal"><span class="pre">name</span> <span class="pre">type</span></code> in the simplest case. For example: <code class="docutils literal"><span class="pre">RegionID</span> <span class="pre">UInt32</span></code>.
Expressions can also be defined for default values (see below).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>CREATE [TEMPORARY] TABLE [IF NOT EXISTS] [db.]name AS [db2.]name2 [ENGINE = engine]
</pre></div>
</div>
<p>Creates a table with the same structure as another table. You can specify a different engine for the table. If the engine is not specified, the same engine will be used as for the &#8216;db2.name2&#8217; table.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>CREATE [TEMPORARY] TABLE [IF NOT EXISTS] [db.]name ENGINE = engine AS SELECT ...
</pre></div>
</div>
<p>Creates a table with a structure like the result of the <code class="docutils literal"><span class="pre">SELECT</span></code> query, with the &#8216;engine&#8217; engine, and fills it with data from SELECT.</p>
<p>In all cases, if IF NOT EXISTS is specified, the query won&#8217;t return an error if the table already exists. In this case, the query won&#8217;t do anything.</p>
<div class="section" id="default-values">
<h3>Default values<a class="headerlink" href="#default-values" title="Permalink to this headline">¶</a></h3>
<p>The column description can specify an expression for a default value, in one of the following ways:
<code class="docutils literal"><span class="pre">DEFAULT</span> <span class="pre">expr</span></code>, <code class="docutils literal"><span class="pre">MATERIALIZED</span> <span class="pre">expr</span></code>, <code class="docutils literal"><span class="pre">ALIAS</span> <span class="pre">expr</span></code>.
Example: <code class="docutils literal"><span class="pre">URLDomain</span> <span class="pre">String</span> <span class="pre">DEFAULT</span> <span class="pre">domain(URL)</span></code>.</p>
<p>If an expression for the default value is not defined, the default values will be set to zeros for numbers, empty strings for strings, empty arrays for arrays, and 0000-00-00 for dates or 0000-00-00 00:00:00 for dates with time. NULLs are not supported.</p>
<p>If the default expression is defined, the column type is optional. If there isn&#8217;t an explicitly defined type, the default expression type is used. Example: <code class="docutils literal"><span class="pre">EventDate</span> <span class="pre">DEFAULT</span> <span class="pre">toDate(EventTime)</span></code> - the &#8216;Date&#8217; type will be used for the &#8216;EventDate&#8217; column.</p>
<p>If the data type and default expression are defined explicitly, this expression will be cast to the specified type using type casting functions. Example: <code class="docutils literal"><span class="pre">Hits</span> <span class="pre">UInt32</span> <span class="pre">DEFAULT</span> <span class="pre">0</span></code> means the same thing as <code class="docutils literal"><span class="pre">Hits</span> <span class="pre">UInt32</span> <span class="pre">DEFAULT</span> <span class="pre">toUInt32(0)</span></code>.</p>
<p>Default expressions may be defined as an arbitrary expression from table constants and columns. When creating and changing the table structure, it checks that expressions don&#8217;t contain loops. For INSERT, it checks that expressions are resolvable - that all columns they can be calculated from have been passed.</p>
<p><code class="docutils literal"><span class="pre">DEFAULT</span> <span class="pre">expr</span></code></p>
<p>Normal default value. If the INSERT query doesn&#8217;t specify the corresponding column, it will be filled in by computing the corresponding expression.</p>
<p><code class="docutils literal"><span class="pre">MATERIALIZED</span> <span class="pre">expr</span></code></p>
<p>Materialized expression. Such a column can&#8217;t be specified for INSERT, because it is always calculated.
For an INSERT without a list of columns, these columns are not considered.
In addition, this column is not substituted when using an asterisk in a SELECT query. This is to preserve the invariant that the dump obtained using SELECT * can be inserted back into the table using INSERT without specifying the list of columns.</p>
<p><code class="docutils literal"><span class="pre">ALIAS</span> <span class="pre">expr</span></code></p>
<p>Synonym. Such a column isn&#8217;t stored in the table at all.
Its values can&#8217;t be inserted in a table, and it is not substituted when using an asterisk in a SELECT query.
It can be used in SELECTs if the alias is expanded during query parsing.</p>
<p>When using the ALTER query to add new columns, old data for these columns is not written. Instead, when reading old data that does not have values for the new columns, expressions are computed on the fly by default. However, if running the expressions requires different columns that are not indicated in the query, these columns will additionally be read, but only for the blocks of data that need it.</p>
<p>If you add a new column to a table but later change its default expression, the values used for old data will change (for data where values were not stored on the disk). Note that when running background merges, data for columns that are missing in one of the merging parts is written to the merged part.</p>
<p>It is not possible to set default values for elements in nested data structures.</p>
</div>
<div class="section" id="temporary-tables">
<h3>Temporary tables<a class="headerlink" href="#temporary-tables" title="Permalink to this headline">¶</a></h3>
<p>In all cases, if TEMPORARY is specified, a temporary table will be created. Temporary tables have the following characteristics:
- Temporary tables disappear when the session ends, including if the connection is lost.
- A temporary table is created with the Memory engine. The other table engines are not supported.
- The DB can&#8217;t be specified for a temporary table. It is created outside of databases.
- If a temporary table has the same name as another one and a query specifies the table name without specifying the DB, the temporary table will be used.
- For distributed query processing, temporary tables used in a query are passed to remote servers.</p>
<p>In most cases, temporary tables are not created manually, but when using external data for a query, or for distributed (GLOBAL) IN. For more information, see the appropriate sections.</p>
</div>
<div class="section" id="distributed-ddl-queries-section-on-cluster">
<h3>Distributed DDL queries (section <code class="docutils literal"><span class="pre">ON</span> <span class="pre">CLUSTER</span></code>)<a class="headerlink" href="#distributed-ddl-queries-section-on-cluster" title="Permalink to this headline">¶</a></h3>
<p>Queries <code class="docutils literal"><span class="pre">CREATE</span></code>, <code class="docutils literal"><span class="pre">DROP</span></code>, <code class="docutils literal"><span class="pre">ALTER</span></code>, <code class="docutils literal"><span class="pre">RENAME</span></code> support distributed execution on cluster.
For example, the following query creates <code class="docutils literal"><span class="pre">Distributed</span></code> table <code class="docutils literal"><span class="pre">all_hits</span></code> for each host of the cluster <code class="docutils literal"><span class="pre">cluster</span></code>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">all_hits</span> <span class="k">ON</span> <span class="k">CLUSTER</span> <span class="k">cluster</span> <span class="p">(</span><span class="n">p</span> <span class="nb">Date</span><span class="p">,</span> <span class="n">i</span> <span class="n">Int32</span><span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">Distributed</span><span class="p">(</span><span class="k">cluster</span><span class="p">,</span> <span class="k">default</span><span class="p">,</span> <span class="n">hits</span><span class="p">)</span>
</pre></div>
</div>
<p>To correctly execute such queries you need to have equal definitions of the cluster on each host (you can use <a class="reference internal" href="../configuration_files.html#configuration-files"><span>ZooKeeper substitutions</span></a> to syncronize configs on hosts) and connection to ZooKeeper quorum.
Local version of the query will be eventually executed on each host of the cluster, even if some hosts are temporary unavaiable; on each host queries are executed stictly sequentually.
At the moment, <code class="docutils literal"><span class="pre">ALTER</span></code> queries for replicated tables are not supported yet.</p>
</div>
</div>
<div class="section" id="create-view">
<h2>CREATE VIEW<a class="headerlink" href="#create-view" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">[MATERIALIZED]</span> <span class="pre">VIEW</span> <span class="pre">[IF</span> <span class="pre">NOT</span> <span class="pre">EXISTS]</span> <span class="pre">[db.]name</span> <span class="pre">[ENGINE</span> <span class="pre">=</span> <span class="pre">engine]</span> <span class="pre">[POPULATE]</span> <span class="pre">AS</span> <span class="pre">SELECT</span> <span class="pre">...</span></code></p>
<p>Creates a view. There are two types of views: normal and MATERIALIZED.</p>
<p>Normal views don&#8217;t store any data, but just perform a read from another table. In other words, a normal view is nothing more than a saved query. When reading from a view, this saved query is used as a subquery in the FROM clause.</p>
<p>As an example, assume you&#8217;ve created a view:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>CREATE VIEW view AS SELECT ...
</pre></div>
</div>
<p>and written a query:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a, b, c FROM view
</pre></div>
</div>
<p>This query is fully equivalent to using the subquery:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a, b, c FROM (SELECT ...)
</pre></div>
</div>
<p>Materialized views store data transformed by the corresponding SELECT query.</p>
<p>When creating a materialized view, you can specify ENGINE - the table engine for storing data. By default, it uses the same engine as for the table that the SELECT query is made from.</p>
<p>A materialized view is arranged as follows: when inserting data to the table specified in SELECT, part of the inserted data is converted by this SELECT query, and the result is inserted in the view.</p>
<p>If you specify POPULATE, the existing table data is inserted in the view when creating it, as if making a CREATE TABLE ... AS SELECT ... query. Otherwise, the query contains only the data inserted in the table after creating the view. We don&#8217;t recommend using POPULATE, since data inserted in the table during the view creation will not be inserted in it.</p>
<p>The SELECT query can contain DISTINCT, GROUP BY, ORDER BY, LIMIT ... Note that the corresponding conversions are performed independently on each block of inserted data. For example, if GROUP BY is set, data is aggregated during insertion, but only within a single packet of inserted data. The data won&#8217;t be further aggregated. The exception is when using an ENGINE that independently performs data aggregation, such as SummingMergeTree.</p>
<p>The execution of ALTER queries on materialized views has not been fully developed, so they might be inconvenient.</p>
<p>Views look the same as normal tables. For example, they are listed in the result of the SHOW TABLES query.</p>
<p>There isn&#8217;t a separate query for deleting views. To delete a view, use DROP TABLE.</p>
</div>
<div class="section" id="attach">
<h2>ATTACH<a class="headerlink" href="#attach" title="Permalink to this headline">¶</a></h2>
<p>The query is exactly the same as CREATE, except
- The word ATTACH is used instead of CREATE.
- The query doesn&#8217;t create data on the disk, but assumes that data is already in the appropriate places, and just adds information about the table to the server.
After executing an ATTACH query, the server will know about the existence of the table.</p>
<p>This query is used when starting the server. The server stores table metadata as files with ATTACH queries, which it simply runs at launch (with the exception of system tables, which are explicitly created on the server).</p>
</div>
<div class="section" id="drop">
<h2>DROP<a class="headerlink" href="#drop" title="Permalink to this headline">¶</a></h2>
<p>This query has two types: <code class="docutils literal"><span class="pre">DROP</span> <span class="pre">DATABASE</span></code> and <code class="docutils literal"><span class="pre">DROP</span> <span class="pre">TABLE</span></code>.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">DATABASE</span> <span class="p">[</span><span class="k">IF</span> <span class="k">EXISTS</span><span class="p">]</span> <span class="n">db</span> <span class="p">[</span><span class="k">ON</span> <span class="k">CLUSTER</span> <span class="k">cluster</span><span class="p">]</span>
</pre></div>
</div>
<p>Deletes all tables inside the &#8216;db&#8217; database, then deletes the &#8216;db&#8217; database itself.
If IF EXISTS is specified, it doesn&#8217;t return an error if the database doesn&#8217;t exist.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="k">IF</span> <span class="k">EXISTS</span><span class="p">]</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="n">name</span> <span class="p">[</span><span class="k">ON</span> <span class="k">CLUSTER</span> <span class="k">cluster</span><span class="p">]</span>
</pre></div>
</div>
<p>Deletes the table.
If IF EXISTS is specified, it doesn&#8217;t return an error if the table doesn&#8217;t exist or the database doesn&#8217;t exist.</p>
</div>
<div class="section" id="detach">
<h2>DETACH<a class="headerlink" href="#detach" title="Permalink to this headline">¶</a></h2>
<p>Deletes information about the table from the server. The server stops knowing about the table&#8217;s existence.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>DETACH TABLE [IF EXISTS] [db.]name
</pre></div>
</div>
<p>This does not delete the table&#8217;s data or metadata. On the next server launch, the server will read the metadata and find out about the table again. Similarly, a &#8220;detached&#8221; table can be re-attached using the ATTACH query (with the exception of system tables, which do not have metadata stored for them).</p>
<p>There is no DETACH DATABASE query.</p>
</div>
<div class="section" id="rename">
<h2>RENAME<a class="headerlink" href="#rename" title="Permalink to this headline">¶</a></h2>
<p>Renames one or more tables.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>   <span class="k">RENAME</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">db11</span><span class="p">.]</span><span class="n">name11</span> <span class="k">TO</span> <span class="p">[</span><span class="n">db12</span><span class="p">.]</span><span class="n">name12</span><span class="p">,</span> <span class="p">[</span><span class="n">db21</span><span class="p">.]</span><span class="n">name21</span> <span class="k">TO</span> <span class="p">[</span><span class="n">db22</span><span class="p">.]</span><span class="n">name22</span><span class="p">,</span> <span class="p">...</span> <span class="p">[</span><span class="k">ON</span> <span class="k">CLUSTER</span> <span class="k">cluster</span><span class="p">]</span>

<span class="k">All</span> <span class="n">tables</span> <span class="k">are</span> <span class="n">renamed</span> <span class="k">under</span> <span class="k">global</span> <span class="n">locking</span><span class="p">.</span> <span class="n">Renaming</span> <span class="n">tables</span> <span class="k">is</span> <span class="n">a</span> <span class="n">light</span> <span class="k">operation</span><span class="p">.</span> <span class="k">If</span> <span class="n">you</span> <span class="n">indicated</span> <span class="n">another</span> <span class="k">database</span> <span class="k">after</span> <span class="k">TO</span><span class="p">,</span> <span class="n">the</span> <span class="k">table</span> <span class="n">will</span> <span class="n">be</span> <span class="n">moved</span> <span class="k">to</span> <span class="n">this</span> <span class="k">database</span><span class="p">.</span> <span class="n">However</span><span class="p">,</span> <span class="n">the</span> <span class="n">directories</span> <span class="k">with</span> <span class="n">databases</span> <span class="n">must</span> <span class="n">reside</span> <span class="k">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">file</span> <span class="k">system</span> <span class="p">(</span><span class="n">otherwise</span><span class="p">,</span> <span class="n">an</span> <span class="n">error</span> <span class="k">is</span> <span class="n">returned</span><span class="p">).</span>
</pre></div>
</div>
</div>
<div class="section" id="alter">
<h2>ALTER<a class="headerlink" href="#alter" title="Permalink to this headline">¶</a></h2>
<p>The ALTER query is only supported for <a href="#id1"><span class="problematic" id="id2">*</span></a>MergeTree type tables, as well as for Merge and Distributed types. The query has several variations.</p>
<div class="section" id="column-manipulations">
<h3>Column manipulations<a class="headerlink" href="#column-manipulations" title="Permalink to this headline">¶</a></h3>
<p>Lets you change the table structure.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">db</span><span class="p">].</span><span class="n">name</span> <span class="p">[</span><span class="k">ON</span> <span class="k">CLUSTER</span> <span class="k">cluster</span><span class="p">]</span> <span class="k">ADD</span><span class="o">|</span><span class="k">DROP</span><span class="o">|</span><span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="p">...</span>
</pre></div>
</div>
<p>In the query, specify a list of one or more comma-separated actions. Each action is an operation on a column.</p>
<p>The following actions are supported:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ADD COLUMN name [type] [default_expr] [AFTER name_after]
</pre></div>
</div>
<p>Adds a new column to the table with the specified name, type, and default expression (see the section &#8220;Default expressions&#8221;). If you specify &#8216;AFTER name_after&#8217; (the name of another column), the column is added after the specified one in the list of table columns. Otherwise, the column is added to the end of the table. Note that there is no way to add a column to the beginning of a table. For a chain of actions, &#8216;name_after&#8217; can be the name of a column that is added in one of the previous actions.</p>
<p>Adding a column just changes the table structure, without performing any actions with data. The data doesn&#8217;t appear on the disk after ALTER. If the data is missing for a column when reading from the table, it is filled in with default values (by performing the default expression if there is one, or using zeros or empty strings). The column appears on the disk after merging data parts (see MergeTree).</p>
<p>This approach allows us to complete the ALTER query instantly, without increasing the volume of old data.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">name</span>
</pre></div>
</div>
<p>Deletes the column with the name &#8216;name&#8217;.</p>
<p>Deletes data from the file system. Since this deletes entire files, the query is completed almost instantly.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="n">name</span> <span class="p">[</span><span class="k">type</span><span class="p">]</span> <span class="p">[</span><span class="n">default_expr</span><span class="p">]</span>
</pre></div>
</div>
<p>Changes the &#8216;name&#8217; column&#8217;s type to &#8216;type&#8217; and/or the default expression to &#8216;default_expr&#8217;. When changing the type, values are converted as if the &#8216;toType&#8217; function were applied to them.</p>
<p>If only the default expression is changed, the query doesn&#8217;t do anything complex, and is completed almost instantly.</p>
<p>Changing the column type is the only complex action - it changes the contents of files with data. For large tables, this may take a long time.</p>
<p>There are several stages of execution:
- Preparing temporary (new) files with modified data.
- Renaming old files.
- Renaming the temporary (new) files to the old names.
- Deleting the old files.</p>
<p>Only the first stage takes time. If there is a failure at this stage, the data is not changed.
If there is a failure during one of the successive stages, data can be restored manually. The exception is if the old files were deleted from the file system but the data for the new files did not get written to the disk and was lost.</p>
<p>There is no support for changing the column type in arrays and nested data structures.</p>
<p>The ALTER query lets you create and delete separate elements (columns) in nested data structures, but not whole nested data structures. To add a nested data structure, you can add columns with a name like &#8216;name.nested_name&#8217; and the type &#8216;Array(T)&#8217;. A nested data structure is equivalent to multiple array columns with a name that has the same prefix before the dot.</p>
<p>There is no support for deleting of columns in the primary key or the sampling key (columns that are in the ENGINE expression). Changing the type of columns in the primary key is allowed only if such change doesn&#8217;t entail changing the actual data (e.g. adding the value to an Enum or changing the type from DateTime to UInt32 is allowed).</p>
<p>If the ALTER query is not sufficient for making the table changes you need, you can create a new table, copy the data to it using the INSERT SELECT query, then switch the tables using the RENAME query and delete the old table.</p>
<p>The ALTER query blocks all reads and writes for the table. In other words, if a long SELECT is running at the time of the ALTER query, the ALTER query will wait for the SELECT to complete. At the same time, all new queries to the same table will wait while this ALTER is running.</p>
<p>For tables that don&#8217;t store data themselves (Merge and Distributed), ALTER just changes the table structure, and does not change the structure of subordinate tables. For example, when running ALTER for a Distributed table, you will also need to run ALTER for the tables on all remote servers.</p>
<p>The ALTER query for changing columns is replicated. The instructions are saved in ZooKeeper, then each replica applies them. All ALTER queries are run in the same order. The query waits for the appropriate actions to be completed on the other replicas. However, a query to change columns in a replicated table can be interrupted, and all actions will be performed asynchronously.</p>
</div>
<div class="section" id="manipulations-with-partitions-and-parts">
<h3>Manipulations with partitions and parts<a class="headerlink" href="#manipulations-with-partitions-and-parts" title="Permalink to this headline">¶</a></h3>
<p>Only works for tables in the MergeTree family. The following operations are available:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">DETACH</span> <span class="pre">PARTITION</span></code> - Move a partition to the &#8216;detached&#8217; directory and forget it.</li>
<li><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">PARTITION</span></code> - Delete a partition.</li>
<li><code class="docutils literal"><span class="pre">ATTACH</span> <span class="pre">PART|PARTITION</span></code> - Add a new part or partition from the &#8216;detached&#8217; directory to the table.</li>
<li><code class="docutils literal"><span class="pre">FREEZE</span> <span class="pre">PARTITION</span></code> - Create a backup of a partition.</li>
<li><code class="docutils literal"><span class="pre">FETCH</span> <span class="pre">PARTITION</span></code> - Download a partition from another server.</li>
</ul>
<p>Each type of query is covered separately below.</p>
<p>A partition in a table is data for a single calendar month. This is determined by the values of the date key specified in the table engine parameters. Each month&#8217;s data is stored separately in order to simplify manipulations with this data.</p>
<p>A &#8220;part&#8221; in the table is part of the data from a single partition, sorted by the primary key.</p>
<p>You can use the <code class="docutils literal"><span class="pre">system.parts</span></code> table to view the set of table parts and partitions:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>SELECT * FROM system.parts WHERE active
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">active</span></code> - Only count active parts. Inactive parts are, for example, source parts remaining after merging to a larger part - these parts are deleted approximately 10 minutes after merging.</p>
<p>Another way to view a set of parts and partitions is to go into the directory with table data.
The directory with data is
/var/lib/clickhouse/data/database/table/,
where /var/lib/clickhouse/ is the path to ClickHouse data, &#8216;database&#8217; is the database name, and &#8216;table&#8217; is the table name. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ls -l /var/lib/clickhouse/data/test/visits/
total 48
drwxrwxrwx 2 clickhouse clickhouse 20480 мая   13 02:58 20140317_20140323_2_2_0
drwxrwxrwx 2 clickhouse clickhouse 20480 мая   13 02:58 20140317_20140323_4_4_0
drwxrwxrwx 2 clickhouse clickhouse  4096 мая   13 02:55 detached
-rw-rw-rw- 1 clickhouse clickhouse     2 мая   13 02:58 increment.txt
</pre></div>
</div>
<p>Here <code class="docutils literal"><span class="pre">20140317_20140323_2_2_0</span></code>, <code class="docutils literal"><span class="pre">20140317_20140323_4_4_0</span></code> - are directories of parts.</p>
<dl class="docutils">
<dt>Let&#8217;s look at the name of the first part: <code class="docutils literal"><span class="pre">20140317_20140323_2_2_0</span></code>.</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">20140317</span></code> - minimum date of part data</li>
<li><code class="docutils literal"><span class="pre">20140323</span></code> - maximum date of part data .. <a href="#id7"><span class="problematic" id="id8">|br|</span></a> raw:: html</li>
<li><code class="docutils literal"><span class="pre">2</span></code> - minimum number of the data block .. <a href="#id9"><span class="problematic" id="id10">|br|</span></a> raw:: html</li>
<li><code class="docutils literal"><span class="pre">2</span></code> - maximum number of the data block .. <a href="#id11"><span class="problematic" id="id12">|br|</span></a> raw:: html</li>
<li><code class="docutils literal"><span class="pre">0</span></code> - part level - depth of the merge tree that formed it</li>
</ul>
</dd>
</dl>
<p>Each part corresponds to a single partition and contains data for a single month.
201403 - The partition name. A partition is a set of parts for a single month.</p>
<p>On an operating server, you can&#8217;t manually change the set of parts or their data on the file system, since the server won&#8217;t know about it. For non-replicated tables, you can do this when the server is stopped, but we don&#8217;t recommended it. For replicated tables, the set of parts can&#8217;t be changed in any case.</p>
<p>The &#8216;detached&#8217; directory contains parts that are not used by the server - detached from the table using the ALTER ... DETACH query. Parts that are damaged are also moved to this directory, instead of deleting them. You can add, delete, or modify the data in the &#8216;detached&#8217; directory at any time - the server won&#8217;t know about this until you make the ALTER TABLE ... ATTACH query.
::
ALTER TABLE [db.]table DETACH PARTITION &#8216;name&#8217;</p>
<p>Move all data for partitions named &#8216;name&#8217; to the &#8216;detached&#8217; directory and forget about them.
The partition name is specified in YYYYMM format. It can be indicated in single quotes or without them.</p>
<p>After the query is executed, you can do whatever you want with the data in the &#8216;detached&#8217; directory — delete it from the file system, or just leave it.</p>
<p>The query is replicated - data will be moved to the &#8216;detached&#8217; directory and forgotten on all replicas. The query can only be sent to a leader replica. To find out if a replica is a leader, perform SELECT to the &#8216;system.replicas&#8217; system table. Alternatively, it is easier to make a query on all replicas, and all except one will throw an exception.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ALTER TABLE [db.]table DROP PARTITION &#39;name&#39;
</pre></div>
</div>
<p>Similar to the DETACH operation. Deletes data from the table. Data parts will be tagged as inactive and will be completely deleted in approximately 10 minutes. The query is replicated - data will be deleted on all replicas.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ALTER TABLE [db.]table ATTACH PARTITION|PART &#39;name&#39;
</pre></div>
</div>
<p>Adds data to the table from the &#8216;detached&#8217; directory.</p>
<p>It is possible to add data for an entire partition or a separate part. For a part, specify the full name of the part in single quotes.</p>
<p>The query is replicated. Each replica checks whether there is data in the &#8216;detached&#8217; directory. If there is data, it checks the integrity, verifies that it matches the data on the server that initiated the query, and then adds it if everything is correct. If not, it downloads data from the query requestor replica, or from another replica where the data has already been added.</p>
<p>So you can put data in the &#8216;detached&#8217; directory on one replica, and use the ALTER ... ATTACH query to add it to the table on all replicas.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ALTER TABLE [db.]table FREEZE PARTITION &#39;name&#39;
</pre></div>
</div>
<p>Creates a local backup of one or multiple partitions. The name can be the full name of the partition (for example, 201403), or its prefix (for example, 2014) - then the backup will be created for all the corresponding partitions.</p>
<p>The query does the following: for a data snapshot at the time of execution, it creates hardlinks to table data in the directory /var/lib/clickhouse/shadow/N/...
/var/lib/clickhouse/ is the working ClickHouse directory from the config.
N is the incremental number of the backup.</p>
<p><code class="docutils literal"><span class="pre">/var/lib/clickhouse/</span></code> - working directory of ClickHouse from config file.
<code class="docutils literal"><span class="pre">N</span></code> - incremental number of backup.</p>
<p>The same structure of directories is created inside the backup as inside  <code class="docutils literal"><span class="pre">/var/lib/clickhouse/</span></code>.
It also performs &#8216;chmod&#8217; for all files, forbidding writes to them.</p>
<p>The backup is created almost instantly (but first it waits for current queries to the corresponding table to finish running). At first, the backup doesn&#8217;t take any space on the disk. As the system works, the backup can take disk space, as data is modified. If the backup is made for old enough data, it won&#8217;t take space on the disk.</p>
<p>After creating the backup, data from <code class="docutils literal"><span class="pre">/var/lib/clickhouse/shadow/</span></code> can be copied to the remote server and then deleted on the local server. The entire backup process is performed without stopping the server.</p>
<p>The <code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">...</span> <span class="pre">FREEZE</span> <span class="pre">PARTITION</span></code> query is not replicated. A local backup is only created on the local server.</p>
<p>As an alternative, you can manually copy data from the <code class="docutils literal"><span class="pre">/var/lib/clickhouse/data/database/table</span> <span class="pre">directory</span></code>. But if you do this while the server is running, race conditions are possible when copying directories with files being added or changed, and the backup may be inconsistent. You can do this if the server isn&#8217;t running - then the resulting data will be the same as after the ALTER TABLE t FREEZE PARTITION query.</p>
<p><code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">...</span> <span class="pre">FREEZE</span> <span class="pre">PARTITION</span></code> only copies data, not table metadata. To make a backup of table metadata, copy the file  <code class="docutils literal"><span class="pre">/var/lib/clickhouse/metadata/database/table.sql</span></code></p>
<p>To restore from a backup:
* Use the CREATE query to create the table if it doesn&#8217;t exist. The query can be taken from an .sql file (replace ATTACH in it with CREATE).
* Copy data from the <code class="docutils literal"><span class="pre">data/database/table/</span></code> directory inside the backup to the <code class="docutils literal"><span class="pre">/var/lib/clickhouse/data/database/table/detached/</span></code> directory.
* Run <code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">...</span> <span class="pre">ATTACH</span> <span class="pre">PARTITION</span> <span class="pre">YYYYMM``queries</span> <span class="pre">where</span> <span class="pre">``YYYYMM</span></code> is the month, for every month.</p>
<p>In this way, data from the backup will be added to the table.
Restoring from a backup doesn&#8217;t require stopping the server.</p>
</div>
<div class="section" id="backups-and-replication">
<h3>Backups and replication<a class="headerlink" href="#backups-and-replication" title="Permalink to this headline">¶</a></h3>
<p>Replication provides protection from device failures. If all data disappeared on one of your replicas, follow the instructions in the &#8220;Restoration after failure&#8221; section to restore it.</p>
<p>For protection from device failures, you must use replication. For more information about replication, see the section &#8220;Data replication&#8221;.</p>
<p>Backups protect against human error (accidentally deleting data, deleting the wrong data or in the wrong cluster, or corrupting data). For high-volume databases, it can be difficult to copy backups to remote servers. In such cases, to protect from human error, you can keep a backup on the same server (it will reside in /var/lib/clickhouse/shadow/).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ALTER TABLE [db.]table FETCH PARTITION &#39;name&#39; FROM &#39;path-in-zookeeper&#39;
</pre></div>
</div>
<p>This query only works for replicatable tables.</p>
<p>It downloads the specified partition from the shard that has its ZooKeeper path specified in the FROM clause, then puts it in the &#8216;detached&#8217; directory for the specified table.</p>
<p>Although the query is called ALTER TABLE, it does not change the table structure, and does not immediately change the data available in the table.</p>
<p>Data is placed in the &#8216;detached&#8217; directory. You can use the ALTER TABLE ... ATTACH query to attach the data.</p>
<p>The path to ZooKeeper is specified in the FROM clause. For example, <code class="docutils literal"><span class="pre">/clickhouse/tables/01-01/visits</span></code>.
Before downloading, the system checks that the partition exists and the table structure matches. The most appropriate replica is selected automatically from the healthy replicas.</p>
<p>The ALTER ... FETCH PARTITION query is not replicated. The partition will be downloaded to the &#8216;detached&#8217; directory only on the local server. Note that if after this you use the ALTER TABLE ... ATTACH query to add data to the table, the data will be added on all replicas (on one of the replicas it will be added from the &#8216;detached&#8217; directory, and on the rest it will be loaded from neighboring replicas).</p>
</div>
<div class="section" id="synchronicity-of-alter-queries">
<h3>Synchronicity of ALTER queries<a class="headerlink" href="#synchronicity-of-alter-queries" title="Permalink to this headline">¶</a></h3>
<p>For non-replicatable tables, all ALTER queries are performed synchronously. For replicatable tables, the query just adds instructions for the appropriate actions to ZooKeeper, and the actions themselves are performed as soon as possible. However, the query can wait for these actions to be completed on all the replicas.</p>
<p>For <code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">...</span> <span class="pre">ATTACH|DETACH|DROP</span></code> queries, you can use the <code class="docutils literal"><span class="pre">'replication_alter_partitions_sync'</span></code> setting to set up waiting.
Possible values: 0 - do not wait, 1 - wait for own completion (default), 2 - wait for all.</p>
</div>
</div>
<div class="section" id="show-databases">
<h2>SHOW DATABASES<a class="headerlink" href="#show-databases" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">DATABASES</span> <span class="p">[</span><span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="n">filename</span><span class="p">]</span> <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
</pre></div>
</div>
<p>Prints a list of all databases.
This query is identical to the query <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">name</span> <span class="pre">FROM</span> <span class="pre">system.databases</span> <span class="pre">[INTO</span> <span class="pre">OUTFILE</span> <span class="pre">filename]</span> <span class="pre">[FORMAT</span> <span class="pre">format]</span></code>
See the section &#8220;Formats&#8221;.</p>
</div>
<div class="section" id="show-tables">
<h2>SHOW TABLES<a class="headerlink" href="#show-tables" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">TABLES</span> <span class="p">[</span><span class="k">FROM</span> <span class="n">db</span><span class="p">]</span> <span class="p">[</span><span class="k">LIKE</span> <span class="s1">&#39;pattern&#39;</span><span class="p">]</span> <span class="p">[</span><span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="n">filename</span><span class="p">]</span> <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
</pre></div>
</div>
<p>Outputs a list of
* tables from the current database, or from the &#8216;db&#8217; database if &#8220;FROM db&#8221; is specified.
* all tables, or tables whose name matches the pattern, if &#8220;LIKE &#8216;pattern&#8217;&#8221; is specified.</p>
<p>The query is identical to the query  SELECT name FROM system.tables
WHERE database = &#8216;db&#8217; [AND name LIKE &#8216;pattern&#8217;] [INTO OUTFILE filename] [FORMAT format]
See the section &#8220;LIKE operator&#8221;.</p>
</div>
<div class="section" id="show-processlist">
<h2>SHOW PROCESSLIST<a class="headerlink" href="#show-processlist" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">PROCESSLIST</span> <span class="p">[</span><span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="n">filename</span><span class="p">]</span> <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
</pre></div>
</div>
<p>Outputs a list of queries currently being processed, other than SHOW PROCESSLIST queries.</p>
<p>Prints a table containing the columns:</p>
<p><strong>user</strong> is the user who made the query. Keep in mind that for distributed processing, queries are sent to remote servers under the &#8216;default&#8217; user. SHOW PROCESSLIST shows the username for a specific query, not for a query that this query initiated.</p>
<p><strong>address</strong> is the name of the host that the query was sent from. For distributed processing, on remote servers, this is the name of the query requestor host. To track where a distributed query was originally made from, look at SHOW PROCESSLIST on the query requestor server.</p>
<p><strong>elapsed</strong> - The execution time, in seconds. Queries are output in order of decreasing execution time.</p>
<p><strong>rows_read</strong>, <strong>bytes_read</strong> - How many rows and bytes of uncompressed data were read when processing the query. For distributed processing, data is totaled from all the remote servers. This is the data used for restrictions and quotas.</p>
<p><strong>memory_usage</strong> - Current RAM usage in bytes. See the setting &#8216;max_memory_usage&#8217;.</p>
<p><strong>query</strong> - The query itself. In INSERT queries, the data for insertion is not output.</p>
<p><strong>query_id</strong> - The query identifier. Non-empty only if it was explicitly defined by the user. For distributed processing, the query ID is not passed to remote servers.</p>
<p>This query is exactly the same as: SELECT * FROM system.processes [INTO OUTFILE filename] [FORMAT format].</p>
<p>Tip (execute in the console):
<code class="docutils literal"><span class="pre">watch</span> <span class="pre">-n1</span> <span class="pre">&quot;clickhouse-client</span> <span class="pre">--query='SHOW</span> <span class="pre">PROCESSLIST'&quot;</span></code></p>
</div>
<div class="section" id="show-create-table">
<h2>SHOW CREATE TABLE<a class="headerlink" href="#show-create-table" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table</span> <span class="p">[</span><span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="n">filename</span><span class="p">]</span> <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
</pre></div>
</div>
<p>Returns a single String-type &#8216;statement&#8217; column, which contains a single value - the CREATE query used for creating the specified table.</p>
</div>
<div class="section" id="describe-table">
<h2>DESCRIBE TABLE<a class="headerlink" href="#describe-table" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">DESC</span><span class="o">|</span><span class="k">DESCRIBE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table</span> <span class="p">[</span><span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="n">filename</span><span class="p">]</span> <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
</pre></div>
</div>
<p>Returns two String-type columns: &#8216;name&#8217; and &#8216;type&#8217;, which indicate the names and types of columns in the specified table.</p>
<p>Nested data structures are output in &#8220;expanded&#8221; format. Each column is shown separately, with the name after a dot.</p>
</div>
<div class="section" id="exists">
<h2>EXISTS<a class="headerlink" href="#exists" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">EXISTS</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="n">name</span> <span class="p">[</span><span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="n">filename</span><span class="p">]</span> <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
</pre></div>
</div>
<p>Returns a single UInt8-type column, which contains the single value 0 if the table or database doesn&#8217;t exist, or 1 if the table exists in the specified database.</p>
</div>
<div class="section" id="use">
<h2>USE<a class="headerlink" href="#use" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">USE</span> <span class="n">db</span>
</pre></div>
</div>
<p>Lets you set the current database for the session.
The current database is used for searching for tables if the database is not explicitly defined in the query with a dot before the table name.
This query can&#8217;t be made when using the HTTP protocol, since there is no concept of a session.</p>
</div>
<div class="section" id="set">
<h2>SET<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SET</span> <span class="p">[</span><span class="k">GLOBAL</span><span class="p">]</span> <span class="n">param</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
<p>Lets you set the &#8216;param&#8217; setting to &#8216;value&#8217;. You can also make all the settings from the specified settings profile in a single query. To do this, specify &#8216;profile&#8217; as the setting name. For more information, see the section &#8220;Settings&#8221;. The setting is made for the session, or for the server (globally) if GLOBAL is specified.
When making a global setting, the setting is not applied to sessions already running, including the current session. It will only be used for new sessions.</p>
<p>Settings made using SET GLOBAL have a lower priority compared with settings made in the config file in the user profile. In other words, user settings can&#8217;t be overridden by SET GLOBAL.</p>
<p>When the server is restarted, global settings made using SET GLOBAL are lost.
To make settings that persist after a server restart, you can only use the server&#8217;s config file. (This can&#8217;t be done using a SET query.)</p>
</div>
<div class="section" id="optimize">
<h2>OPTIMIZE<a class="headerlink" href="#optimize" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">OPTIMIZE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="n">name</span> <span class="p">[</span><span class="n">PARTITION</span> <span class="n">partition</span><span class="p">]</span> <span class="p">[</span><span class="k">FINAL</span><span class="p">]</span>
</pre></div>
</div>
<p>Asks the table engine to do something for optimization.
Supported only by <a href="#id3"><span class="problematic" id="id4">*</span></a>MergeTree engines, in which this query initializes a non-scheduled merge of data parts.
If <code class="docutils literal"><span class="pre">PARTITION</span></code> is specified, then only specified partition will be optimized.
If <code class="docutils literal"><span class="pre">FINAL</span></code> is specified, then optimization will be performed even if data inside the partition already optimized (i. e. all data is in single part).</p>
</div>
<div class="section" id="insert">
<h2>INSERT<a class="headerlink" href="#insert" title="Permalink to this headline">¶</a></h2>
<p>This query has several variations.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table</span> <span class="p">[(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">v11</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">v13</span><span class="p">),</span> <span class="p">(</span><span class="n">v21</span><span class="p">,</span> <span class="n">v22</span><span class="p">,</span> <span class="n">v23</span><span class="p">),</span> <span class="p">...</span>
</pre></div>
</div>
<p>Inserts rows with the listed values in the &#8216;table&#8217; table.
This query is exactly the same as:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table</span> <span class="p">[(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span> <span class="n">FORMAT</span> <span class="k">Values</span> <span class="p">(</span><span class="n">v11</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">v13</span><span class="p">),</span> <span class="p">(</span><span class="n">v21</span><span class="p">,</span> <span class="n">v22</span><span class="p">,</span> <span class="n">v23</span><span class="p">),</span> <span class="p">...</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table</span> <span class="p">[(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span> <span class="n">FORMAT</span> <span class="n">format</span> <span class="p">...</span>
</pre></div>
</div>
<p>Inserts data in any specified format.
The data itself comes after &#8216;format&#8217;, after all space symbols up to the first line break if there is one and including it, or after all space symbols if there isn&#8217;t a line break. We recommend writing data starting from the next line (this is important if the data starts with space characters).</p>
<p>Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span> <span class="n">FORMAT</span> <span class="n">TabSeparated</span>
<span class="mi">11</span>  <span class="n">Hello</span><span class="p">,</span> <span class="n">world</span><span class="o">!</span>
<span class="mi">22</span>  <span class="n">Qwerty</span>
</pre></div>
</div>
<p>For more information about data formats, see the section &#8220;Formats&#8221;. The &#8220;Interfaces&#8221; section describes how to insert data separately from the query when using the command-line client or the HTTP interface.</p>
<p>The query may optionally specify a list of columns for insertion. In this case, the default values are written to the other columns.
Default values are calculated from DEFAULT expressions specified in table definitions, or, if the DEFAULT is not explicitly defined, zeros and empty strings are used. If the &#8216;strict_insert_default&#8217; setting is set to 1, all the columns that do not have explicit DEFAULTS must be specified in the query.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table</span> <span class="p">[(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span> <span class="k">SELECT</span> <span class="p">...</span>
</pre></div>
</div>
<p>Inserts the result of the SELECT query into a table.
The names and data types of the SELECT result must exactly match the table structure that data is inserted into, or the specified list of columns.
To change column names, use synonyms (AS) in the SELECT query.
To change data types, use type conversion functions (see the section &#8220;Functions&#8221;).</p>
<p>None of the data formats allows using expressions as values.
In other words, you can&#8217;t write INSERT INTO t VALUES (now(), 1 + 1, DEFAULT).</p>
<p>There is no support for other data part modification queries:
UPDATE, DELETE, REPLACE, MERGE, UPSERT, INSERT UPDATE.
However, you can delete old data using ALTER TABLE ... DROP PARTITION.</p>
</div>
<div class="section" id="select">
<h2>SELECT<a class="headerlink" href="#select" title="Permalink to this headline">¶</a></h2>
<p>His Highness, the SELECT query.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="p">[</span><span class="k">DISTINCT</span><span class="p">]</span> <span class="n">expr_list</span>
    <span class="p">[</span><span class="k">FROM</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table</span> <span class="o">|</span> <span class="p">(</span><span class="n">subquery</span><span class="p">)</span> <span class="o">|</span> <span class="n">table_function</span><span class="p">]</span> <span class="p">[</span><span class="k">FINAL</span><span class="p">]</span>
    <span class="p">[</span><span class="n">SAMPLE</span> <span class="n">sample_coeff</span><span class="p">]</span>
    <span class="p">[</span><span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="p">...]</span>
    <span class="p">[</span><span class="k">GLOBAL</span><span class="p">]</span> <span class="k">ANY</span><span class="o">|</span><span class="k">ALL</span> <span class="k">INNER</span><span class="o">|</span><span class="k">LEFT</span> <span class="k">JOIN</span> <span class="p">(</span><span class="n">subquery</span><span class="p">)</span><span class="o">|</span><span class="k">table</span> <span class="k">USING</span> <span class="n">columns_list</span>
    <span class="p">[</span><span class="n">PREWHERE</span> <span class="n">expr</span><span class="p">]</span>
    <span class="p">[</span><span class="k">WHERE</span> <span class="n">expr</span><span class="p">]</span>
    <span class="p">[</span><span class="k">GROUP</span> <span class="k">BY</span> <span class="n">expr_list</span><span class="p">]</span> <span class="p">[</span><span class="k">WITH</span> <span class="n">TOTALS</span><span class="p">]</span>
    <span class="p">[</span><span class="k">HAVING</span> <span class="n">expr</span><span class="p">]</span>
    <span class="p">[</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">expr_list</span><span class="p">]</span>
    <span class="p">[</span><span class="k">LIMIT</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">]</span><span class="n">m</span><span class="p">]</span>
    <span class="p">[</span><span class="k">UNION</span> <span class="k">ALL</span> <span class="p">...]</span>
    <span class="p">[</span><span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="n">filename</span><span class="p">]</span>
    <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
</pre></div>
</div>
<p>All the clauses are optional, except for the required list of expressions immediately after SELECT.
The clauses below are described in almost the same order as in the query execution conveyor.</p>
<p>If the query omits the DISTINCT, GROUP BY, and ORDER BY clauses and the IN and JOIN subqueries, the query will be completely stream processed, using O(1) amount of RAM.
Otherwise, the query may consume too much RAM, if appropriate restrictions are not defined (max_memory_usage, max_rows_to_group_by, max_rows_to_sort, max_rows_in_distinct, max_bytes_in_distinct, max_rows_in_set, max_bytes_in_set, max_rows_in_join, max_bytes_in_join, max_bytes_before_external_sort, max_bytes_before_external_group_by). For more information, see the section &#8220;Settings&#8221;. It is possible to use external sorting (saving temporary tables to a disk) and external aggregation. Merge join is not implemented.</p>
<div class="section" id="from-clause">
<h3>FROM clause<a class="headerlink" href="#from-clause" title="Permalink to this headline">¶</a></h3>
<p>If the FROM clause is omitted, data will be read from the &#8216;system.one&#8217; table.
The &#8216;system.one&#8217; table contains exactly one row (this table fulfills the same purpose as the DUAL table found in other DBMSs).</p>
<p>The FROM clause specifies the table to read data from, or a subquery, or a table function; ARRAY JOIN and the regular JOIN may also be included (see below).</p>
<p>Instead of a table, the SELECT subquery may be specified in brackets. In this case, the subquery processing pipeline will be built into the processing pipeline of an external query.
In contrast to standard SQL, a synonym does not need to be specified after a subquery. For compatibility, it is possible to write &#8216;AS name&#8217; after a subquery, but the specified name isn&#8217;t used anywhere.</p>
<p>A table function may be specified instead of a table. For more information, see the section &#8220;Table functions&#8221;.</p>
<p>To execute a query, all the columns listed in the query are extracted from the appropriate table. Any columns not needed for the external query are thrown out of the subqueries.
If a query does not list any columns (for example, SELECT count() FROM t), some column is extracted from the table anyway (the smallest one is preferred), in order to calculate the number of rows.</p>
<p>The FINAL modifier can be used only for a SELECT from a CollapsingMergeTree table. When you specify FINAL, data is selected fully &#8220;collapsed&#8221;. Keep in mind that using FINAL leads to a selection that includes columns related to the primary key, in addition to the columns specified in the SELECT. Additionally, the query will be executed in a single stream, and data will be merged during query execution. This means that when using FINAL, the query is processed more slowly. In most cases, you should avoid using FINAL. For more information, see the section &#8220;CollapsingMergeTree engine&#8221;.</p>
</div>
<div class="section" id="sample-clause">
<h3>SAMPLE clause<a class="headerlink" href="#sample-clause" title="Permalink to this headline">¶</a></h3>
<p>The SAMPLE clause allows for approximated query processing.
Approximated query processing is only supported by MergeTree* type tables, and only if the sampling expression was specified during table creation (see the section &#8220;MergeTree engine&#8221;).</p>
<p>SAMPLE has the format <code class="docutils literal"><span class="pre">SAMPLE</span> <span class="pre">k</span></code>, where &#8216;k&#8217; is a decimal number from 0 to 1, or <code class="docutils literal"><span class="pre">SAMPLE</span> <span class="pre">n</span></code>, where &#8216;n&#8217; is a sufficiently large integer.</p>
<p>In the first case, the query will be executed on &#8216;k&#8217; percent of data. For example, <code class="docutils literal"><span class="pre">SAMPLE</span> <span class="pre">0.1</span></code> runs the query on 10% of data.
In the second case, the query will be executed on a sample of no more than &#8216;n&#8217; rows. For example, <code class="docutils literal"><span class="pre">SAMPLE</span> <span class="pre">10000000</span></code> runs the query on a maximum of 10,000,000 rows.</p>
<p>Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="n">Title</span><span class="p">,</span>
    <span class="k">count</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">AS</span> <span class="n">PageViews</span>
<span class="k">FROM</span> <span class="n">hits_distributed</span>
<span class="n">SAMPLE</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
<span class="k">WHERE</span>
    <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span>
    <span class="k">AND</span> <span class="n">toDate</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">toDate</span><span class="p">(</span><span class="s1">&#39;2013-01-29&#39;</span><span class="p">)</span>
    <span class="k">AND</span> <span class="n">toDate</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">toDate</span><span class="p">(</span><span class="s1">&#39;2013-02-04&#39;</span><span class="p">)</span>
    <span class="k">AND</span> <span class="k">NOT</span> <span class="n">DontCountHits</span>
    <span class="k">AND</span> <span class="k">NOT</span> <span class="n">Refresh</span>
    <span class="k">AND</span> <span class="n">Title</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">Title</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">PageViews</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>In this example, the query is executed on a sample from 0.1 (10%) of data. Values of aggregate functions are not corrected automatically, so to get an approximate result, the value &#8216;count()&#8217; is manually multiplied by 10.</p>
<p>When using something like <code class="docutils literal"><span class="pre">SAMPLE</span> <span class="pre">10000000</span></code>, there isn&#8217;t any information about which relative percent of data was processed or what the aggregate functions should be multiplied by, so this method of writing is not always appropriate to the situation.</p>
<p>A sample with a relative coefficient is &#8220;consistent&#8221;: if we look at all possible data that could be in the table, a sample (when using a single sampling expression specified during table creation) with the same coefficient always selects the same subset of possible data. In other words, a sample from different tables on different servers at different times is made the same way.</p>
<p>For example, a sample of user IDs takes rows with the same subset of all the possible user IDs from different tables. This allows using the sample in subqueries in the IN clause, as well as for manually correlating results of different queries with samples.</p>
</div>
<div class="section" id="array-join-clause">
<h3>ARRAY JOIN clause<a class="headerlink" href="#array-join-clause" title="Permalink to this headline">¶</a></h3>
<p>Allows executing JOIN with an array or nested data structure. The intent is similar to the &#8216;arrayJoin&#8217; function, but its functionality is broader.</p>
<p>ARRAY JOIN is essentially INNER JOIN with an array. Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>:) CREATE TABLE arrays_test (s String, arr Array(UInt8)) ENGINE = Memory

CREATE TABLE arrays_test
(
    s String,
    arr Array(UInt8)
) ENGINE = Memory

Ok.

0 rows in set. Elapsed: 0.001 sec.

:) INSERT INTO arrays_test VALUES (&#39;Hello&#39;, [1,2]), (&#39;World&#39;, [3,4,5]), (&#39;Goodbye&#39;, [])

INSERT INTO arrays_test VALUES

Ok.

3 rows in set. Elapsed: 0.001 sec.

:) SELECT * FROM arrays_test

SELECT *
FROM arrays_test

┌─s───────┬─arr─────┐
│ Hello   │ [1,2]   │
│ World   │ [3,4,5] │
│ Goodbye │ []      │
└─────────┴─────────┘

3 rows in set. Elapsed: 0.001 sec.

:) SELECT s, arr FROM arrays_test ARRAY JOIN arr

SELECT s, arr
FROM arrays_test
ARRAY JOIN arr

┌─s─────┬─arr─┐
│ Hello │   1 │
│ Hello │   2 │
│ World │   3 │
│ World │   4 │
│ World │   5 │
└───────┴─────┘

5 rows in set. Elapsed: 0.001 sec.
</pre></div>
</div>
<p>An alias can be specified for an array in the ARRAY JOIN clause. In this case, an array item can be accessed by this alias, but the array itself by the original name. Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>:) SELECT s, arr, a FROM arrays_test ARRAY JOIN arr AS a

SELECT s, arr, a
FROM arrays_test
ARRAY JOIN arr AS a

┌─s─────┬─arr─────┬─a─┐
│ Hello │ [1,2]   │ 1 │
│ Hello │ [1,2]   │ 2 │
│ World │ [3,4,5] │ 3 │
│ World │ [3,4,5] │ 4 │
│ World │ [3,4,5] │ 5 │
└───────┴─────────┴───┘

5 rows in set. Elapsed: 0.001 sec.
</pre></div>
</div>
<p>Multiple arrays of the same size can be comma-separated in the ARRAY JOIN clause. In this case, JOIN is performed with them simultaneously (the direct sum, not the direct product).
Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>:) SELECT s, arr, a, num, mapped FROM arrays_test ARRAY JOIN arr AS a, arrayEnumerate(arr) AS num, arrayMap(x -&gt; x + 1, arr) AS mapped

SELECT s, arr, a, num, mapped
FROM arrays_test
ARRAY JOIN arr AS a, arrayEnumerate(arr) AS num, arrayMap(lambda(tuple(x), plus(x, 1)), arr) AS mapped

┌─s─────┬─arr─────┬─a─┬─num─┬─mapped─┐
│ Hello │ [1,2]   │ 1 │   1 │      2 │
│ Hello │ [1,2]   │ 2 │   2 │      3 │
│ World │ [3,4,5] │ 3 │   1 │      4 │
│ World │ [3,4,5] │ 4 │   2 │      5 │
│ World │ [3,4,5] │ 5 │   3 │      6 │
└───────┴─────────┴───┴─────┴────────┘

5 rows in set. Elapsed: 0.002 sec.

:) SELECT s, arr, a, num, arrayEnumerate(arr) FROM arrays_test ARRAY JOIN arr AS a, arrayEnumerate(arr) AS num

SELECT s, arr, a, num, arrayEnumerate(arr)
FROM arrays_test
ARRAY JOIN arr AS a, arrayEnumerate(arr) AS num

┌─s─────┬─arr─────┬─a─┬─num─┬─arrayEnumerate(arr)─┐
│ Hello │ [1,2]   │ 1 │   1 │ [1,2]               │
│ Hello │ [1,2]   │ 2 │   2 │ [1,2]               │
│ World │ [3,4,5] │ 3 │   1 │ [1,2,3]             │
│ World │ [3,4,5] │ 4 │   2 │ [1,2,3]             │
│ World │ [3,4,5] │ 5 │   3 │ [1,2,3]             │
└───────┴─────────┴───┴─────┴─────────────────────┘

5 rows in set. Elapsed: 0.002 sec.
</pre></div>
</div>
<p>ARRAY JOIN also works with nested data structures. Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>:) CREATE TABLE nested_test (s String, nest Nested(x UInt8, y UInt32)) ENGINE = Memory

CREATE TABLE nested_test
(
    s String,
    nest Nested(
    x UInt8,
    y UInt32)
) ENGINE = Memory

Ok.

0 rows in set. Elapsed: 0.006 sec.

:) INSERT INTO nested_test VALUES (&#39;Hello&#39;, [1,2], [10,20]), (&#39;World&#39;, [3,4,5], [30,40,50]), (&#39;Goodbye&#39;, [], [])

INSERT INTO nested_test VALUES

Ok.

3 rows in set. Elapsed: 0.001 sec.

:) SELECT * FROM nested_test

SELECT *
FROM nested_test

┌─s───────┬─nest.x──┬─nest.y─────┐
│ Hello   │ [1,2]   │ [10,20]    │
│ World   │ [3,4,5] │ [30,40,50] │
│ Goodbye │ []      │ []         │
└─────────┴─────────┴────────────┘

3 rows in set. Elapsed: 0.001 sec.

:) SELECT s, nest.x, nest.y FROM nested_test ARRAY JOIN nest

SELECT s, `nest.x`, `nest.y`
FROM nested_test
ARRAY JOIN nest

┌─s─────┬─nest.x─┬─nest.y─┐
│ Hello │      1 │     10 │
│ Hello │      2 │     20 │
│ World │      3 │     30 │
│ World │      4 │     40 │
│ World │      5 │     50 │
└───────┴────────┴────────┘

5 rows in set. Elapsed: 0.001 sec.
</pre></div>
</div>
<p>When specifying names of nested data structures in ARRAY JOIN, the meaning is the same as ARRAY JOIN with all the array elements that it consists of. Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>:) SELECT s, nest.x, nest.y FROM nested_test ARRAY JOIN nest.x, nest.y

SELECT s, `nest.x`, `nest.y`
FROM nested_test
ARRAY JOIN `nest.x`, `nest.y`

┌─s─────┬─nest.x─┬─nest.y─┐
│ Hello │      1 │     10 │
│ Hello │      2 │     20 │
│ World │      3 │     30 │
│ World │      4 │     40 │
│ World │      5 │     50 │
└───────┴────────┴────────┘

5 rows in set. Elapsed: 0.001 sec.
</pre></div>
</div>
<p>This variation also makes sense:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>:) SELECT s, nest.x, nest.y FROM nested_test ARRAY JOIN nest.x

SELECT s, `nest.x`, `nest.y`
FROM nested_test
ARRAY JOIN `nest.x`

┌─s─────┬─nest.x─┬─nest.y─────┐
│ Hello │      1 │ [10,20]    │
│ Hello │      2 │ [10,20]    │
│ World │      3 │ [30,40,50] │
│ World │      4 │ [30,40,50] │
│ World │      5 │ [30,40,50] │
└───────┴────────┴────────────┘

5 rows in set. Elapsed: 0.001 sec.
</pre></div>
</div>
<p>An alias may be used for a nested data structure, in order to select either the JOIN result or the source array. Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>:) SELECT s, n.x, n.y, nest.x, nest.y FROM nested_test ARRAY JOIN nest AS n

SELECT s, `n.x`, `n.y`, `nest.x`, `nest.y`
FROM nested_test
ARRAY JOIN nest AS n

┌─s─────┬─n.x─┬─n.y─┬─nest.x──┬─nest.y─────┐
│ Hello │   1 │  10 │ [1,2]   │ [10,20]    │
│ Hello │   2 │  20 │ [1,2]   │ [10,20]    │
│ World │   3 │  30 │ [3,4,5] │ [30,40,50] │
│ World │   4 │  40 │ [3,4,5] │ [30,40,50] │
│ World │   5 │  50 │ [3,4,5] │ [30,40,50] │
└───────┴─────┴─────┴─────────┴────────────┘

5 rows in set. Elapsed: 0.001 sec.
</pre></div>
</div>
<p>Example of using the arrayEnumerate function:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>:) SELECT s, n.x, n.y, nest.x, nest.y, num FROM nested_test ARRAY JOIN nest AS n, arrayEnumerate(nest.x) AS num

SELECT s, `n.x`, `n.y`, `nest.x`, `nest.y`, num
FROM nested_test
ARRAY JOIN nest AS n, arrayEnumerate(`nest.x`) AS num

┌─s─────┬─n.x─┬─n.y─┬─nest.x──┬─nest.y─────┬─num─┐
│ Hello │   1 │  10 │ [1,2]   │ [10,20]    │   1 │
│ Hello │   2 │  20 │ [1,2]   │ [10,20]    │   2 │
│ World │   3 │  30 │ [3,4,5] │ [30,40,50] │   1 │
│ World │   4 │  40 │ [3,4,5] │ [30,40,50] │   2 │
│ World │   5 │  50 │ [3,4,5] │ [30,40,50] │   3 │
└───────┴─────┴─────┴─────────┴────────────┴─────┘

5 rows in set. Elapsed: 0.002 sec.
</pre></div>
</div>
<p>The query can only specify a single ARRAY JOIN clause.</p>
<p>The corresponding conversion can be performed before the WHERE/PREWHERE clause (if its result is needed in this clause), or after completing WHERE/PREWHERE (to reduce the volume of calculations).</p>
</div>
<div class="section" id="join-clause">
<h3>JOIN clause<a class="headerlink" href="#join-clause" title="Permalink to this headline">¶</a></h3>
<p>The normal JOIN, which is not related to ARRAY JOIN described above.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">[</span><span class="k">GLOBAL</span><span class="p">]</span> <span class="k">ANY</span><span class="o">|</span><span class="k">ALL</span> <span class="k">INNER</span><span class="o">|</span><span class="k">LEFT</span> <span class="p">[</span><span class="k">OUTER</span><span class="p">]</span> <span class="k">JOIN</span> <span class="p">(</span><span class="n">subquery</span><span class="p">)</span><span class="o">|</span><span class="k">table</span> <span class="k">USING</span> <span class="n">columns_list</span>
</pre></div>
</div>
<p>Performs joins with data from the subquery. At the beginning of query execution, the subquery specified after JOIN is run, and its result is saved in memory. Then it is read from the &#8220;left&#8221; table specified in the FROM clause, and while it is being read, for each of the read rows from the &#8220;left&#8221; table, rows are selected from the subquery results table (the &#8220;right&#8221; table) that meet the condition for matching the values of the columns specified in USING.</p>
<p>The table name can be specified instead of a subquery. This is equivalent to the &#8216;SELECT * FROM table&#8217; subquery, except in a special case when the table has the Join engine - an array prepared for joining.</p>
<p>All columns that are not needed for the JOIN are deleted from the subquery.</p>
<p>There are several types of JOINs:</p>
<p>INNER or LEFT - the type:
If INNER is specified, the result will contain only those rows that have a matching row in the right table.
If LEFT is specified, any rows in the left table that don&#8217;t have matching rows in the right table will be assigned the default value - zeros or empty rows. LEFT OUTER may be written instead of LEFT; the word OUTER does not affect anything.</p>
<p>ANY or ALL - strictness:
If ANY is specified and there are multiple matching rows in the right table, only the first one will be joined.
If ALL is specified and there are multiple matching rows in the right table, the data will be multiplied by the number of these rows.</p>
<p>Using ALL corresponds to the normal JOIN semantic from standard SQL.
Using ANY is optimal. If the right table has only one matching row, the results of ANY and ALL are the same. You must specify either ANY or ALL (neither of them is selected by default).</p>
<p>GLOBAL - distribution:</p>
<p>When using a normal <code class="docutils literal"><span class="pre">JOIN</span></code>, the query is sent to remote servers. Subqueries are run on each of them in order to make the right table, and the join is performed with this table. In other words, the right table is formed on each server separately.</p>
<p>When using <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">...</span> <span class="pre">JOIN</span></code>, first the requestor server runs a subquery to calculate the right table. This temporary table is passed to each remote server, and queries are run on them using the temporary data that was transmitted.</p>
<p>Be careful when using GLOBAL JOINs. For more information, see the section &#8220;Distributed subqueries&#8221; below.</p>
<p>Any combination of JOINs is possible. For example, <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">ANY</span> <span class="pre">LEFT</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span></code>.</p>
<p>When running JOINs, there is no optimization of the order of execution in relation to other stages of the query. The join (a search in the right table) is run before filtering in WHERE and before aggregation. In order to explicitly set the order of execution, we recommend running a JOIN subquery with a subquery.</p>
<p>Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>SELECT
    CounterID,
    hits,
    visits
FROM
(
    SELECT
        CounterID,
        count() AS hits
    FROM test.hits
    GROUP BY CounterID
) ANY LEFT JOIN
(
    SELECT
        CounterID,
        sum(Sign) AS visits
    FROM test.visits
    GROUP BY CounterID
) USING CounterID
ORDER BY hits DESC
LIMIT 10

┌─CounterID─┬───hits─┬─visits─┐
│   1143050 │ 523264 │  13665 │
│    731962 │ 475698 │ 102716 │
│    722545 │ 337212 │ 108187 │
│    722889 │ 252197 │  10547 │
│   2237260 │ 196036 │   9522 │
│  23057320 │ 147211 │   7689 │
│    722818 │  90109 │  17847 │
│     48221 │  85379 │   4652 │
│  19762435 │  77807 │   7026 │
│    722884 │  77492 │  11056 │
└───────────┴────────┴────────┘
</pre></div>
</div>
<p>Subqueries don&#8217;t allow you to set names or use them for referencing a column from a specific subquery.
The columns specified in USING must have the same names in both subqueries, and the other columns must be named differently. You can use aliases to change the names of columns in subqueries (the example uses the aliases &#8216;hits&#8217; and &#8216;visits&#8217;).</p>
<p>The USING clause specifies one or more columns to join, which establishes the equality of these columns. The list of columns is set without brackets. More complex join conditions are not supported.</p>
<p>The right table (the subquery result) resides in RAM. If there isn&#8217;t enough memory, you can&#8217;t run a JOIN.</p>
<p>Only one JOIN can be specified in a query (on a single level). To run multiple JOINs, you can put them in subqueries.</p>
<p>Each time a query is run with the same JOIN, the subquery is run again - the result is not cached. To avoid this, use the special &#8216;Join&#8217; table engine, which is a prepared array for joining that is always in RAM. For more information, see the section &#8220;Table engines, Join&#8221;.</p>
<p>In some cases, it is more efficient to use IN instead of JOIN. Among the various types of JOINs, the most efficient is ANY LEFT JOIN, then ANY INNER JOIN. The least efficient are ALL LEFT JOIN and ALL INNER JOIN.</p>
<p>If you need a JOIN for joining with dimension tables (these are relatively small tables that contain dimension properties, such as names for advertising campaigns), a JOIN might not be very convenient due to the bulky syntax and the fact that the right table is re-accessed for every query. For such cases, there is an &#8220;external dictionaries&#8221; feature that you should use instead of JOIN. For more information, see the section &#8220;External dictionaries&#8221;.</p>
</div>
<div class="section" id="where-clause">
<h3>WHERE clause<a class="headerlink" href="#where-clause" title="Permalink to this headline">¶</a></h3>
<p>If there is a WHERE clause, it must contain an expression with the UInt8 type. This is usually an expression with comparison and logical operators.
This expression will be used for filtering data before all other transformations.</p>
<p>If indexes are supported by the database table engine, the expression is evaluated on the ability to use indexes.</p>
</div>
<div class="section" id="prewhere-clause">
<h3>PREWHERE clause<a class="headerlink" href="#prewhere-clause" title="Permalink to this headline">¶</a></h3>
<p>This clause has the same meaning as the WHERE clause. The difference is in which data is read from the table. When using PREWHERE, first only the columns necessary for executing PREWHERE are read. Then the other columns are read that are needed for running the query, but only those blocks where the PREWHERE expression is true.</p>
<p>It makes sense to use PREWHERE if there are filtration conditions that are not suitable for indexes that are used by a minority of the columns in the query, but that provide strong data filtration. This reduces the volume of data to read.</p>
<p>For example, it is useful to write PREWHERE for queries that extract a large number of columns, but that only have filtration for a few columns.</p>
<p>PREWHERE is only supported by <a href="#id5"><span class="problematic" id="id6">*</span></a>MergeTree tables.</p>
<p>A query may simultaneously specify PREWHERE and WHERE. In this case, PREWHERE precedes WHERE.</p>
<p>Keep in mind that it does not make much sense for PREWHERE to only specify those columns that have an index, because when using an index, only the data blocks that match the index are read.</p>
<p>If the &#8216;optimize_move_to_prewhere&#8217; setting is set to 1 and PREWHERE is omitted, the system uses heuristics to automatically move parts of expressions from WHERE to PREWHERE.</p>
</div>
<div class="section" id="group-by-clause">
<h3>GROUP BY clause<a class="headerlink" href="#group-by-clause" title="Permalink to this headline">¶</a></h3>
<p>This is one of the most important parts of a column-oriented DBMS.</p>
<p>If there is a GROUP BY clause, it must contain a list of expressions. Each expression will be referred to here as a &#8220;key&#8221;.
All the expressions in the SELECT, HAVING, and ORDER BY clauses must be calculated from keys or from aggregate functions. In other words, each column selected from the table must be used either in keys or inside aggregate functions.</p>
<p>If a query contains only table columns inside aggregate functions, the GROUP BY clause can be omitted, and aggregation by an empty set of keys is assumed.</p>
<p>Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="k">count</span><span class="p">(),</span>
    <span class="n">median</span><span class="p">(</span><span class="n">FetchTiming</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="o">?</span> <span class="mi">60</span> <span class="p">:</span> <span class="n">FetchTiming</span><span class="p">),</span>
    <span class="k">count</span><span class="p">()</span> <span class="o">-</span> <span class="k">sum</span><span class="p">(</span><span class="n">Refresh</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">hits</span>
</pre></div>
</div>
<p>However, in contrast to standard SQL, if the table doesn&#8217;t have any rows (either there aren&#8217;t any at all, or there aren&#8217;t any after using WHERE to filter), an empty result is returned, and not the result from one of the rows containing the initial values of aggregate functions.</p>
<p>As opposed to MySQL (and conforming to standard SQL), you can&#8217;t get some value of some column that is not in a key or aggregate function (except constant expressions). To work around this, you can use the &#8216;any&#8217; aggregate function (get the first encountered value) or &#8216;min/max&#8217;.</p>
<p>Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="n">domainWithoutWWW</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span> <span class="k">AS</span> <span class="k">domain</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(),</span>
    <span class="k">any</span><span class="p">(</span><span class="n">Title</span><span class="p">)</span> <span class="k">AS</span> <span class="n">title</span> <span class="c1">-- для каждого домена достаём первый попавшийся заголовок страницы</span>
<span class="k">FROM</span> <span class="n">hits</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">domain</span>
</pre></div>
</div>
<p>For every different key value encountered, GROUP BY calculates a set of aggregate function values.</p>
<p>GROUP BY is not supported for array columns.</p>
<p>A constant can&#8217;t be specified as arguments for aggregate functions. Example: sum(1). Instead of this, you can get rid of the constant. Example: <code class="docutils literal"><span class="pre">count()</span></code>.</p>
<div class="section" id="with-totals-modifier">
<h4>WITH TOTALS modifier<a class="headerlink" href="#with-totals-modifier" title="Permalink to this headline">¶</a></h4>
<p>If the WITH TOTALS modifier is specified, another row will be calculated. This row will have key columns containing default values (zeros or empty lines), and columns of aggregate functions with the values calculated across all the rows (the &#8220;total&#8221; values).</p>
<p>This extra row is output in JSON*, TabSeparated*, and Pretty* formats, separately from the other rows. In the other formats, this row is not output.</p>
<p>In JSON* formats, this row is output as a separate &#8216;totals&#8217; field. In TabSeparated formats, the row comes after the main result, preceded by an empty row (after the other data). In Pretty formats, the row is output as a separate table after the main result.</p>
<p><code class="docutils literal"><span class="pre">WITH</span> <span class="pre">TOTALS</span></code> can be run in different ways when HAVING is present. The behavior depends on the &#8216;totals_mode&#8217; setting.
By default, totals_mode = &#8216;before_having&#8217;. In this case, &#8216;totals&#8217; is calculated across all rows, including the ones that don&#8217;t pass through HAVING and &#8216;max_rows_to_group_by&#8217;.</p>
<p>The other alternatives include only the rows that pass through HAVING in &#8216;totals&#8217;, and behave differently with the setting &#8216;max_rows_to_group_by&#8217; and &#8216;group_by_overflow_mode = &#8216;any&#8217;&#8216;.</p>
<p><code class="docutils literal"><span class="pre">after_having_exclusive</span></code> - Don&#8217;t include rows that didn&#8217;t pass through <code class="docutils literal"><span class="pre">'max_rows_to_group_by'</span></code>. In other words, &#8216;totals&#8217; will have less than or the same number of rows as it would if &#8216;max_rows_to_group_by&#8217; were omitted.</p>
<p><code class="docutils literal"><span class="pre">after_having_inclusive</span></code> - Include all the rows that didn&#8217;t pass through <code class="docutils literal"><span class="pre">'max_rows_to_group_by'</span></code> in &#8216;totals&#8217;. In other words, &#8216;totals&#8217; will have more than or the same number of rows as it would if &#8216;max_rows_to_group_by&#8217; were omitted.</p>
<p><code class="docutils literal"><span class="pre">after_having_auto</span></code> - Count the number of rows that passed through HAVING. If it is more than a certain amount (by default, 50%), include all the rows that didn&#8217;t pass through &#8216;max_rows_to_group_by&#8217; in &#8216;totals&#8217;. Otherwise, do not include them.</p>
<p><code class="docutils literal"><span class="pre">totals_auto_threshold</span></code> - By default, 0.5 is the coefficient for <code class="docutils literal"><span class="pre">after_having_auto</span></code>.</p>
<p>If &#8216;max_rows_to_group_by&#8217; and &#8216;group_by_overflow_mode = &#8216;any&#8217;&#8217; are not used, all variations of &#8216;after_having&#8217; are the same, and you can use any of them (for example, &#8216;after_having_auto&#8217;).</p>
<p>You can use WITH TOTALS in subqueries, including subqueries in the JOIN clause. In this case, the respective total values are combined.</p>
</div>
<div class="section" id="external-memory-group-by">
<h4>external memory GROUP BY<a class="headerlink" href="#external-memory-group-by" title="Permalink to this headline">¶</a></h4>
<p>It is possible to turn on spilling temporary data to disk to limit memory consumption during the execution of GROUP BY. Value of <code class="docutils literal"><span class="pre">max_bytes_before_external_group_by</span></code> setting determines the maximum memory consumption before temporary data is dumped to the file system. If it is 0 (the default value), the feature is turned off.</p>
<p>When using <code class="docutils literal"><span class="pre">max_bytes_before_external_group_by</span></code> it is advisable to set <code class="docutils literal"><span class="pre">max_memory_usage</span></code> to an approximately twice greater value. The reason for this is that aggregation is executed in two stages: reading and generation of intermediate data (1) and merging of intermediate data (2). Spilling data to the filesystem can be performed only on stage 1. If the spilling did not happen, then stage 2 could consume up to the same amount of memory as stage 1.</p>
<p>For example: if <code class="docutils literal"><span class="pre">max_memory_usage</span></code> is equal to 10000000000 and you want to use external aggregation, it makes sense to set <code class="docutils literal"><span class="pre">max_bytes_before_external_group_by</span></code> to 10000000000 and <code class="docutils literal"><span class="pre">max_memory_usage</span></code> to 20000000000. If dumping data to the file system happened at least once during the execution, maximum memory consumption would be just a little bit higher than <code class="docutils literal"><span class="pre">max_bytes_before_external_group_by</span></code>.</p>
<p>During distributed query execution external aggregation is performed on the remote servers. If you want the memory consumption on the originating server to be small, set <code class="docutils literal"><span class="pre">distributed_aggregation_memory_efficient</span></code> to 1. If <code class="docutils literal"><span class="pre">distributed_aggregation_memory_efficient</span></code> is turned on then during merging of the dumped data and also during merging of the query results from the remote servers, total memory consumption is no more than 1/256 * number of threads of the total amount of memory.</p>
<p>If external aggregation is turned on and total memory consumption was less than <code class="docutils literal"><span class="pre">max_bytes_before_external_group_by</span></code> (meaning that no spilling took place), the query performance is the same as when external aggregation is turned off. If some data was dumped, then execution time will be several times longer (approximately 3x).</p>
<p>If you have an ORDER BY clause with some small LIMIT after a GROUP BY, then ORDER BY will not consume significant amount of memory. But if no LIMIT is provided, don&#8217;t forget to turn on external sorting (<code class="docutils literal"><span class="pre">max_bytes_before_external_sort</span></code>).</p>
</div>
<div class="section" id="limit-n-by-modifier">
<h4>LIMIT N BY modifier<a class="headerlink" href="#limit-n-by-modifier" title="Permalink to this headline">¶</a></h4>
<p>LIMIT <code class="docutils literal"><span class="pre">N</span></code> BY <code class="docutils literal"><span class="pre">COLUMNS</span></code> allows you to restrict top <code class="docutils literal"><span class="pre">N</span></code> rows per each group of <code class="docutils literal"><span class="pre">COLUMNS</span></code>. <code class="docutils literal"><span class="pre">LIMIT</span> <span class="pre">N</span> <span class="pre">BY</span></code> is unrelated to <code class="docutils literal"><span class="pre">LIMIT</span></code> clause. Key for <code class="docutils literal"><span class="pre">LIMIT</span> <span class="pre">N</span> <span class="pre">BY</span></code> could contain arbitrary number of columns or expressions.</p>
<p>Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="n">domainWithoutWWW</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span> <span class="k">AS</span> <span class="k">domain</span><span class="p">,</span>
    <span class="n">domainWithoutWWW</span><span class="p">(</span><span class="n">REFERRER_URL</span><span class="p">)</span> <span class="k">AS</span> <span class="n">referrer</span><span class="p">,</span>
    <span class="n">device_type</span><span class="p">,</span>
    <span class="k">count</span><span class="p">()</span> <span class="n">cnt</span>
<span class="k">FROM</span> <span class="n">hits</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">domain</span><span class="p">,</span> <span class="n">referrer</span><span class="p">,</span> <span class="n">device_type</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cnt</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">5</span> <span class="k">BY</span> <span class="k">domain</span><span class="p">,</span> <span class="n">device_type</span>
<span class="k">LIMIT</span> <span class="mi">100</span>
</pre></div>
</div>
<p>will select top 5 referrers for each domain - device type pair, total number of rows - 100.</p>
</div>
</div>
<div class="section" id="having-clause">
<h3>HAVING clause<a class="headerlink" href="#having-clause" title="Permalink to this headline">¶</a></h3>
<p>Allows filtering the result received after GROUP BY, similar to the WHERE clause.
WHERE and HAVING differ in that WHERE is performed before aggregation (GROUP BY), while HAVING is performed after it. If aggregation is not performed, HAVING can&#8217;t be used.</p>
</div>
<div class="section" id="order-by-clause">
<h3>ORDER BY clause<a class="headerlink" href="#order-by-clause" title="Permalink to this headline">¶</a></h3>
<p>The ORDER BY clause contains a list of expressions, which can each be assigned DESC or ASC (the sorting direction). If the direction is not specified, ASC is assumed. ASC is sorted in ascending order, and DESC in descending order. The sorting direction applies to a single expression, not to the entire list. Example: <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">Visits</span> <span class="pre">DESC,</span> <span class="pre">SearchPhrase</span></code></p>
<p>For sorting by String values, you can specify collation (comparison). Example: <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">SearchPhrase</span> <span class="pre">COLLATE</span> <span class="pre">'tr'</span></code> - for sorting by keyword in ascending order, using the Turkish alphabet, case insensitive, assuming that strings are UTF-8 encoded. COLLATE can be specified or not for each expression in ORDER BY independently. If ASC or DESC is specified, COLLATE is specified after it. When using COLLATE, sorting is always case-insensitive.</p>
<p>We only recommend using COLLATE for final sorting of a small number of rows, since sorting with COLLATE is less efficient than normal sorting by bytes.</p>
<p>Rows that have identical values for the list of sorting expressions are output in an arbitrary order, which can also be nondeterministic (different each time).
If the ORDER BY clause is omitted, the order of the rows is also undefined, and may be nondeterministic as well.</p>
<p>When floating point numbers are sorted, NaNs are separate from the other values. Regardless of the sorting order, NaNs come at the end. In other words, for ascending sorting they are placed as if they are larger than all the other numbers, while for descending sorting they are placed as if they are smaller than the rest.</p>
<p>Less RAM is used if a small enough LIMIT is specified in addition to ORDER BY. Otherwise, the amount of memory spent is proportional to the volume of data for sorting. For distributed query processing, if GROUP BY is omitted, sorting is partially done on remote servers, and the results are merged on the requestor server. This means that for distributed sorting, the volume of data to sort can be greater than the amount of memory on a single server.</p>
<p>If there is not enough RAM, it is possible to perform sorting in external memory (creating temporary files on a disk). Use the setting max_bytes_before_external_sort for this purpose. If it is set to 0 (the default), external sorting is disabled. If it is enabled, when the volume of data to sort reaches the specified number of bytes, the collected data is sorted and dumped into a temporary file. After all data is read, all the sorted files are merged and the results are output. Files are written to the /var/lib/clickhouse/tmp/ directory in the config (by default, but you can use the &#8216;tmp_path&#8217; parameter to change this setting).</p>
<p>Running a query may use more memory than <code class="docutils literal"><span class="pre">'max_bytes_before_external_sort'</span></code>. For this reason, this setting must have a value significantly smaller than &#8216;max_memory_usage&#8217;. As an example, if your server has 128 GB of RAM and you need to run a single query, set &#8216;max_memory_usage&#8217; to 100 GB, and &#8216;max_bytes_before_external_sort&#8217; to 80 GB.</p>
<p>External sorting works much less effectively than sorting in RAM.</p>
</div>
<div class="section" id="select-clause">
<h3>SELECT clause<a class="headerlink" href="#select-clause" title="Permalink to this headline">¶</a></h3>
<p>The expressions specified in the SELECT clause are analyzed after the calculations for all the clauses listed above are completed.
More specifically, expressions are analyzed that are above the aggregate functions, if there are any aggregate functions. The aggregate functions and everything below them are calculated during aggregation (GROUP BY). These expressions work as if they are applied to separate rows in the result.</p>
</div>
<div class="section" id="distinct-clause">
<h3>DISTINCT clause<a class="headerlink" href="#distinct-clause" title="Permalink to this headline">¶</a></h3>
<p>If DISTINCT is specified, only a single row will remain out of all the sets of fully matching rows in the result.
The result will be the same as if GROUP BY were specified across all the fields specified in SELECT without aggregate functions. But there are several differences from GROUP BY:</p>
<ul class="simple">
<li>DISTINCT can be applied together with GROUP BY.</li>
<li>When ORDER BY is omitted and LIMIT is defined, the query stops running immediately after the required number of different rows has been read. In this case, using DISTINCT is much more optimal.</li>
<li>Data blocks are output as they are processed, without waiting for the entire query to finish running.</li>
</ul>
<p>DISTINCT is not supported if SELECT has at least one array column.</p>
</div>
<div class="section" id="limit-clause">
<h3>LIMIT clause<a class="headerlink" href="#limit-clause" title="Permalink to this headline">¶</a></h3>
<p>LIMIT m allows you to select the first &#8216;m&#8217; rows from the result.
LIMIT n, m allows you to select the first &#8216;m&#8217; rows from the result after skipping the first &#8216;n&#8217; rows.</p>
<p>&#8216;n&#8217; and &#8216;m&#8217; must be non-negative integers.</p>
<p>If there isn&#8217;t an ORDER BY clause that explicitly sorts results, the result may be arbitrary and nondeterministic.</p>
</div>
<div class="section" id="union-all-clause">
<h3>UNION ALL clause<a class="headerlink" href="#union-all-clause" title="Permalink to this headline">¶</a></h3>
<p>You can use UNION ALL to combine any number of queries. Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">CounterID</span><span class="p">,</span> <span class="mi">1</span> <span class="k">AS</span> <span class="k">table</span><span class="p">,</span> <span class="n">toInt64</span><span class="p">(</span><span class="k">count</span><span class="p">())</span> <span class="k">AS</span> <span class="k">c</span>
    <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">hits</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">CounterID</span>

<span class="k">UNION</span> <span class="k">ALL</span>

<span class="k">SELECT</span> <span class="n">CounterID</span><span class="p">,</span> <span class="mi">2</span> <span class="k">AS</span> <span class="k">table</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">Sign</span><span class="p">)</span> <span class="k">AS</span> <span class="k">c</span>
    <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">visits</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">CounterID</span>
    <span class="k">HAVING</span> <span class="k">c</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Only UNION ALL is supported. The regular UNION (UNION DISTINCT) is not supported. If you need UNION DISTINCT, you can write SELECT DISTINCT from a subquery containing UNION ALL.</p>
<p>Queries that are parts of UNION ALL can be run simultaneously, and their results can be mixed together.</p>
<p>The structure of results (the number and type of columns) must match for the queries, but the column names can differ. In this case, the column names for the final result will be taken from the first query.</p>
<p>Queries that are parts of UNION ALL can&#8217;t be enclosed in brackets. ORDER BY and LIMIT are applied to separate queries, not to the final result. If you need to apply a conversion to the final result, you can put all the queries with UNION ALL in a subquery in the FROM clause.</p>
</div>
<div class="section" id="into-outfile-clause">
<h3>INTO OUTFILE clause<a class="headerlink" href="#into-outfile-clause" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">INTO</span> <span class="pre">OUTFILE</span></code> filename clause (where filename is a string literal) to redirect query output to a file filename.
In contrast to MySQL the file is created on a client host. The query will fail if a file with the same filename already exists.
INTO OUTFILE is available in the command-line client and clickhouse-local (a query sent via HTTP interface will fail).</p>
<p>Default output format is TabSeparated (the same as in the batch mode of command-line client).</p>
</div>
<div class="section" id="format-clause">
<h3>FORMAT clause<a class="headerlink" href="#format-clause" title="Permalink to this headline">¶</a></h3>
<p>Specify &#8216;FORMAT format&#8217; to get data in any specified format.
You can use this for convenience, or for creating dumps. For more information, see the section &#8220;Formats&#8221;.
If the FORMAT clause is omitted, the default format is used, which depends on both the settings and the interface used for accessing the DB. For the HTTP interface and the command-line client in batch mode, the default format is TabSeparated. For the command-line client in interactive mode, the default format is PrettyCompact (it has attractive and compact tables).</p>
<p>When using the command-line client, data is passed to the client in an internal efficient format. The client independently interprets the FORMAT clause of the query and formats the data itself (thus relieving the network and the server from the load).</p>
</div>
<div class="section" id="in-operators">
<h3>IN operators<a class="headerlink" href="#in-operators" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">IN</span></code>, <code class="docutils literal"><span class="pre">NOT</span> <span class="pre">IN</span></code>, <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">IN</span></code>, and <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">NOT</span> <span class="pre">IN</span></code> operators are covered separately, since their functionality is quite rich.</p>
<p>The left side of the operator is either a single column or a tuple.</p>
<p>Examples:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">)</span> <span class="k">FROM</span> <span class="p">...</span>
<span class="k">SELECT</span> <span class="p">(</span><span class="n">CounterID</span><span class="p">,</span> <span class="n">UserID</span><span class="p">)</span> <span class="k">IN</span> <span class="p">((</span><span class="mi">34</span><span class="p">,</span> <span class="mi">123</span><span class="p">),</span> <span class="p">(</span><span class="mi">101500</span><span class="p">,</span> <span class="mi">456</span><span class="p">))</span> <span class="k">FROM</span> <span class="p">...</span>
</pre></div>
</div>
<p>If the left side is a single column that is in the index, and the right side is a set of constants, the system uses the index for processing the query.</p>
<p>Don&#8217;t list too many values explicitly (i.e. millions). If a data set is large, put it in a temporary table (for example, see the section &#8220;External data for query processing&#8221;), then use a subquery.</p>
<p>The right side of the operator can be a set of constant expressions, a set of tuples with constant expressions (shown in the examples above), or the name of a database table or SELECT subquery in brackets.</p>
<p>If the right side of the operator is the name of a table (for example, <code class="docutils literal"><span class="pre">UserID</span> <span class="pre">IN</span> <span class="pre">users</span></code>), this is equivalent to the subquery <code class="docutils literal"><span class="pre">UserID</span> <span class="pre">IN</span> <span class="pre">(SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">users)</span></code>. Use this when working with external data that is sent along with the query. For example, the query can be sent together with a set of user IDs loaded to the &#8216;users&#8217; temporary table, which should be filtered.</p>
<p>If the right side of the operator is a table name that has the Set engine (a prepared data set that is always in RAM), the data set will not be created over again for each query.</p>
<p>The subquery may specify more than one column for filtering tuples.
Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="p">(</span><span class="n">CounterID</span><span class="p">,</span> <span class="n">UserID</span><span class="p">)</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">CounterID</span><span class="p">,</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="p">...)</span> <span class="k">FROM</span> <span class="p">...</span>
</pre></div>
</div>
<p>The columns to the left and right of the <code class="docutils literal"><span class="pre">IN</span></code> operator should have the same type.</p>
<p>The IN operator and subquery may occur in any part of the query, including in aggregate functions and lambda functions.
Example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>SELECT
    EventDate,
    avg(UserID IN
    (
        SELECT UserID
        FROM test.hits
        WHERE EventDate = toDate(&#39;2014-03-17&#39;)
    )) AS ratio
FROM test.hits
GROUP BY EventDate
ORDER BY EventDate ASC

┌──EventDate─┬────ratio─┐
│ 2014-03-17 │        1 │
│ 2014-03-18 │ 0.807696 │
│ 2014-03-19 │ 0.755406 │
│ 2014-03-20 │ 0.723218 │
│ 2014-03-21 │ 0.697021 │
│ 2014-03-22 │ 0.647851 │
│ 2014-03-23 │ 0.648416 │
└────────────┴──────────┘
</pre></div>
</div>
<ul class="simple">
<li>for each day after March 17th, count the percentage of pageviews made by users who visited the site on March 17th.</li>
</ul>
<p>A subquery in the IN clause is always run just one time on a single server. There are no dependent subqueries.</p>
</div>
<div class="section" id="distributed-subqueries">
<h3>Distributed subqueries<a class="headerlink" href="#distributed-subqueries" title="Permalink to this headline">¶</a></h3>
<p>There are two versions of INs with subqueries (and for JOINs): the regular <code class="docutils literal"><span class="pre">IN</span></code> / <code class="docutils literal"><span class="pre">JOIN</span></code>, and <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">IN</span></code> / <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">JOIN</span></code>. They differ in how they are run for distributed query processing.</p>
<p>When using the regular <code class="docutils literal"><span class="pre">IN</span></code>, the query is sent to remote servers, and each of them runs the subqueries in the IN or JOIN clause.</p>
<p>When using <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">IN</span></code> / <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">JOIN</span></code>, first all the subqueries for <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">IN</span></code> / <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">JOIN</span></code> are run, and the results are collected in temporary tables. Then the temporary tables are sent to each remote server, where the queries are run using this temporary data.</p>
<p>For a non-distributed query, use the regular <code class="docutils literal"><span class="pre">IN</span></code> / <code class="docutils literal"><span class="pre">JOIN</span></code>.</p>
<p>Be careful when using subqueries in the  <code class="docutils literal"><span class="pre">IN</span></code> / <code class="docutils literal"><span class="pre">JOIN</span></code> clauses for distributed query processing.</p>
<p>Let&#8217;s look at some examples. Assume that each server in the cluster has a normal local_table. Each server also has a <strong>distributed_table</strong> table with the Distributed type, which looks at all the servers in the cluster.</p>
<p>For a query to the <strong>distributed_table</strong>, the query will be sent to all the remote servers and run on them using the <strong>local_table</strong>.</p>
<p>For example, the query</p>
<p><code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">uniq(UserID)</span> <span class="pre">FROM</span> <span class="pre">distributed_table</span></code></p>
<p>will be sent to all the remote servers as</p>
<p><code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">uniq(UserID)</span> <span class="pre">FROM</span> <span class="pre">local_table</span></code></p>
<p>and run on each of them in parallel, until it reaches the stage where intermediate results can be combined. Then the intermediate results will be returned to the requestor server and merged on it, and the final result will be sent to the client.</p>
<p>Now let&#8217;s examine a query with IN:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>calculates the overlap in the audiences of two websites.</li>
</ul>
<p>This query will be sent to all the remote servers as</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>
</div>
<p>In other words, the data set in the IN clause will be collected on each server independently, only across the data that is stored locally on each of the servers.</p>
<p>This will work correctly and optimally if you are prepared for this case and have spread data across the cluster servers such that the data for a single UserID resides entirely on a single server. In this case, all the necessary data will be available locally on each server. Otherwise, the result will be inaccurate. We refer to this variation of the query as &#8220;local IN&#8221;.</p>
<p>To correct how the query works when data is spread randomly across the cluster servers, you could specify <strong>distributed_table</strong> inside a subquery. The query would look like this:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>
</div>
<p>This query will be sent to all remote servers as</p>
<p>Each of the remote servers will start running the subquery. Since the subquery uses a distributed table, each remote server will re-send the subquery to every remote server, as</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span>
</pre></div>
</div>
<p>For example, if you have a cluster of 100 servers, executing the entire query will require 10,000 elementary requests, which is generally considered unacceptable.</p>
<p>In such cases, you should always use <code class="docutils literal"><span class="pre">GLOBAL</span> <span class="pre">IN</span></code> instead of <code class="docutils literal"><span class="pre">IN</span></code>. Let&#8217;s look at how it works for the query</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">GLOBAL</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>
</div>
<p>The requestor server will execute the subquery</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span>
</pre></div>
</div>
<p>and the result will be put in a temporary table in RAM. Then a query will be sent to each remote server as</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">GLOBAL</span> <span class="k">IN</span> <span class="n">_data1</span>
</pre></div>
</div>
<p>and the temporary table &#8216;_data1&#8217; will be sent to every remote server together with the query (the name of the temporary table is implementation-defined).</p>
<p>This is more optimal than using the normal IN. However, keep the following points in mind:</p>
<ol class="arabic simple">
<li>When creating a temporary table, data is not made unique. To reduce the volume of data transmitted over the network, specify DISTINCT in the subquery. (You don&#8217;t need to do this for a normal IN.)</li>
<li>The temporary table will be sent to all the remote servers. Transmission does not account for network topology. For example, if 10 remote servers reside in a datacenter that is very remote in relation to the requestor server, the data will be sent 10 times over the channel to the remote datacenter. Try to avoid large data sets when using GLOBAL IN.</li>
<li>When transmitting data to remote servers, restrictions on network bandwidth are not configurable. You might overload the network.</li>
<li>Try to distribute data across servers so that you don&#8217;t need to use GLOBAL IN on a regular basis.</li>
<li>If you need to use GLOBAL IN often, plan the location of the ClickHouse cluster so that in each datacenter, there will be at least one replica of each shard, and there is a fast network between them - for possibility to process query with transferring data only inside datacenter.</li>
</ol>
<p>It also makes sense to specify a local table in the GLOBAL IN clause, in case this local table is only available on the requestor server and you want to use data from it on remote servers.</p>
</div>
<div class="section" id="extreme-values">
<h3>Extreme values<a class="headerlink" href="#extreme-values" title="Permalink to this headline">¶</a></h3>
<p>In addition to results, you can also get minimum and maximum values for the results columns. To do this, set the &#8216;extremes&#8217; setting to &#8216;1&#8217;. Minimums and maximums are calculated for numeric types, dates, and dates with times. For other columns, the default values are output.</p>
<p>An extra two rows are calculated - the minimums and maximums, respectively. These extra two rows are output in JSON*, TabSeparated*, and Pretty* formats, separate from the other rows. They are not output for other formats.</p>
<p>In JSON* formats, the extreme values are output in a separate &#8216;extremes&#8217; field. In TabSeparated formats, the row comes after the main result, and after &#8216;totals&#8217; if present. It is preceded by an empty row (after the other data). In Pretty formats, the row is output as a separate table after the main result, and after &#8216;totals&#8217; if present.</p>
<p>Extreme values are calculated for rows that have passed through LIMIT. However, when using &#8216;LIMIT offset, size&#8217;, the rows before &#8216;offset&#8217; are included in &#8216;extremes&#8217;. In stream requests, the result may also include a small number of rows that passed through LIMIT.</p>
</div>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<p>The GROUP BY and ORDER BY clauses do not support positional arguments. This contradicts MySQL, but conforms to standard SQL.
For example, <code class="docutils literal"><span class="pre">'GROUP</span> <span class="pre">BY</span> <span class="pre">1,</span> <span class="pre">2'</span></code> will be interpreted as grouping by constants (i.e. aggregation of all rows into one).</p>
<p>You can use synonyms (AS aliases) in any part of a query.</p>
<p>You can put an asterisk in any part of a query instead of an expression. When the query is analyzed, the asterisk is expanded to a list of all table columns (excluding the <code class="docutils literal"><span class="pre">MATERIALIZED</span></code> and ALIAS columns). There are only a few cases when using an asterisk is justified:
* When creating a table dump.
* For tables containing just a few columns, such as system tables.
* For getting information about what columns are in a table. In this case, set <code class="docutils literal"><span class="pre">'LIMIT</span> <span class="pre">1'</span></code>. But it is better to use the <code class="docutils literal"><span class="pre">DESC</span> <span class="pre">TABLE</span></code> query.
* When there is strong filtration on a small number of columns using <code class="docutils literal"><span class="pre">PREWHERE</span></code>.
* In subqueries (since columns that aren&#8217;t needed for the external query are excluded from subqueries).
In all other cases, we don&#8217;t recommend using the asterisk, since it only gives you the drawbacks of a columnar DBMS instead of the advantages.</p>
</div>
</div>
<div class="section" id="kill-query">
<h2>KILL QUERY<a class="headerlink" href="#kill-query" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">KILL</span> <span class="n">QUERY</span> <span class="k">WHERE</span> <span class="o">&lt;</span><span class="k">where</span> <span class="n">expression</span> <span class="k">to</span> <span class="k">SELECT</span> <span class="k">FROM</span> <span class="k">system</span><span class="p">.</span><span class="n">processes</span> <span class="n">query</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">SYNC</span><span class="o">|</span><span class="n">ASYNC</span><span class="o">|</span><span class="n">TEST</span><span class="p">]</span> <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
</pre></div>
</div>
<p>Tries to finish currently executing queries.
Queries to be finished are selected from <code class="docutils literal"><span class="pre">system.processes</span></code> table according to expression after WHERE term.</p>
<p>Examples:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">KILL</span> <span class="n">QUERY</span> <span class="k">WHERE</span> <span class="n">query_id</span><span class="o">=</span><span class="s1">&#39;2-857d-4a57-9ee0-327da5d60a90&#39;</span>
</pre></div>
</div>
<p>Finishes all queries with specified query_id.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">KILL</span> <span class="n">QUERY</span> <span class="k">WHERE</span> <span class="k">user</span><span class="o">=</span><span class="s1">&#39;username&#39;</span> <span class="n">SYNC</span>
</pre></div>
</div>
<p>Synchronously finishes all queries of user <code class="docutils literal"><span class="pre">username</span></code>.</p>
<p>Readonly users can kill only own queries.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.svg" alt="Logo"/>
    
    <h1 class="logo logo-name">ClickHouse</h1>
    
  </a>
</p>










<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Query language</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="clickhouse_local.html">clickhouse-local</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-database">CREATE DATABASE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-table">CREATE TABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#default-values">Default values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#temporary-tables">Temporary tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distributed-ddl-queries-section-on-cluster">Distributed DDL queries (section <code class="docutils literal"><span class="pre">ON</span> <span class="pre">CLUSTER</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#create-view">CREATE VIEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attach">ATTACH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#drop">DROP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detach">DETACH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rename">RENAME</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alter">ALTER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#column-manipulations">Column manipulations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manipulations-with-partitions-and-parts">Manipulations with partitions and parts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backups-and-replication">Backups and replication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#synchronicity-of-alter-queries">Synchronicity of ALTER queries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#show-databases">SHOW DATABASES</a></li>
<li class="toctree-l3"><a class="reference internal" href="#show-tables">SHOW TABLES</a></li>
<li class="toctree-l3"><a class="reference internal" href="#show-processlist">SHOW PROCESSLIST</a></li>
<li class="toctree-l3"><a class="reference internal" href="#show-create-table">SHOW CREATE TABLE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#describe-table">DESCRIBE TABLE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exists">EXISTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use">USE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set">SET</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimize">OPTIMIZE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#insert">INSERT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#select">SELECT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#from-clause">FROM clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-clause">SAMPLE clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#array-join-clause">ARRAY JOIN clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#join-clause">JOIN clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#where-clause">WHERE clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prewhere-clause">PREWHERE clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#group-by-clause">GROUP BY clause</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#with-totals-modifier">WITH TOTALS modifier</a></li>
<li class="toctree-l5"><a class="reference internal" href="#external-memory-group-by">external memory GROUP BY</a></li>
<li class="toctree-l5"><a class="reference internal" href="#limit-n-by-modifier">LIMIT N BY modifier</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#having-clause">HAVING clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#order-by-clause">ORDER BY clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#select-clause">SELECT clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distinct-clause">DISTINCT clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limit-clause">LIMIT clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#union-all-clause">UNION ALL clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#into-outfile-clause">INTO OUTFILE clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#format-clause">FORMAT clause</a></li>
<li class="toctree-l4"><a class="reference internal" href="#in-operators">IN operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distributed-subqueries">Distributed subqueries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extreme-values">Extreme values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#kill-query">KILL QUERY</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="syntax.html">Syntax</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../external_data.html">External data for query processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../table_engines/index.html">Table engines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system_tables/index.html">System tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../table_functions/index.html">Table functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats/index.html">Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_types/index.html">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operators/index.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/index.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agg_functions/index.html">Aggregate functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agg_functions/index.html#parametric-aggregate-functions">Parametric aggregate functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agg_functions/index.html#aggregate-function-combinators">Aggregate function combinators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dicts/index.html">Dictionaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../settings/index.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_files.html">Configuration files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../access_rights.html">Access rights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quotas.html">Quotas</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="/docs/ru/">Documentation in Russian</a></li>
    
    <li class="toctree-l1"><a href="/docs/en/single/">Single page documentation</a></li>
    
    <li class="toctree-l1"><a href="/">Website home</a></li>
    
    <li class="toctree-l1"><a href="https://github.com/yandex/ClickHouse">GitHub</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Query language</a><ul>
      <li>Previous: <a href="clickhouse_local.html" title="previous chapter">clickhouse-local</a></li>
      <li>Next: <a href="syntax.html" title="next chapter">Syntax</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016–2017 Yandex LLC.
      
    </div>

    

    
  </body>
</html>